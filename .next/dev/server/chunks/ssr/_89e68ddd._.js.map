{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/utils/mixamoVRMRigMap.ts"],"sourcesContent":["/**\n * A map from Mixamo rig name to VRM Humanoid bone name\n */\nexport const mixamoVRMRigMap: Record<string, string> = {\n  mixamorigHips: \"hips\",\n  mixamorigSpine: \"spine\",\n  mixamorigSpine1: \"chest\",\n  mixamorigSpine2: \"upperChest\",\n  mixamorigNeck: \"neck\",\n  mixamorigHead: \"head\",\n  mixamorigLeftShoulder: \"leftShoulder\",\n  mixamorigLeftArm: \"leftUpperArm\",\n  mixamorigLeftForeArm: \"leftLowerArm\",\n  mixamorigLeftHand: \"leftHand\",\n  mixamorigLeftHandThumb1: \"leftThumbMetacarpal\",\n  mixamorigLeftHandThumb2: \"leftThumbProximal\",\n  mixamorigLeftHandThumb3: \"leftThumbDistal\",\n  mixamorigLeftHandIndex1: \"leftIndexProximal\",\n  mixamorigLeftHandIndex2: \"leftIndexIntermediate\",\n  mixamorigLeftHandIndex3: \"leftIndexDistal\",\n  mixamorigLeftHandMiddle1: \"leftMiddleProximal\",\n  mixamorigLeftHandMiddle2: \"leftMiddleIntermediate\",\n  mixamorigLeftHandMiddle3: \"leftMiddleDistal\",\n  mixamorigLeftHandRing1: \"leftRingProximal\",\n  mixamorigLeftHandRing2: \"leftRingIntermediate\",\n  mixamorigLeftHandRing3: \"leftRingDistal\",\n  mixamorigLeftHandPinky1: \"leftLittleProximal\",\n  mixamorigLeftHandPinky2: \"leftLittleIntermediate\",\n  mixamorigLeftHandPinky3: \"leftLittleDistal\",\n  mixamorigRightShoulder: \"rightShoulder\",\n  mixamorigRightArm: \"rightUpperArm\",\n  mixamorigRightForeArm: \"rightLowerArm\",\n  mixamorigRightHand: \"rightHand\",\n  mixamorigRightHandPinky1: \"rightLittleProximal\",\n  mixamorigRightHandPinky2: \"rightLittleIntermediate\",\n  mixamorigRightHandPinky3: \"rightLittleDistal\",\n  mixamorigRightHandRing1: \"rightRingProximal\",\n  mixamorigRightHandRing2: \"rightRingIntermediate\",\n  mixamorigRightHandRing3: \"rightRingDistal\",\n  mixamorigRightHandMiddle1: \"rightMiddleProximal\",\n  mixamorigRightHandMiddle2: \"rightMiddleIntermediate\",\n  mixamorigRightHandMiddle3: \"rightMiddleDistal\",\n  mixamorigRightHandIndex1: \"rightIndexProximal\",\n  mixamorigRightHandIndex2: \"rightIndexIntermediate\",\n  mixamorigRightHandIndex3: \"rightIndexDistal\",\n  mixamorigRightHandThumb1: \"rightThumbMetacarpal\",\n  mixamorigRightHandThumb2: \"rightThumbProximal\",\n  mixamorigRightHandThumb3: \"rightThumbDistal\",\n  mixamorigLeftUpLeg: \"leftUpperLeg\",\n  mixamorigLeftLeg: \"leftLowerLeg\",\n  mixamorigLeftFoot: \"leftFoot\",\n  mixamorigLeftToeBase: \"leftToes\",\n  mixamorigRightUpLeg: \"rightUpperLeg\",\n  mixamorigRightLeg: \"rightLowerLeg\",\n  mixamorigRightFoot: \"rightFoot\",\n  mixamorigRightToeBase: \"rightToes\",\n};\n"],"names":[],"mappings":"AAAA;;CAEC;;;;AACM,MAAM,kBAA0C;IACrD,eAAe;IACf,gBAAgB;IAChB,iBAAiB;IACjB,iBAAiB;IACjB,eAAe;IACf,eAAe;IACf,uBAAuB;IACvB,kBAAkB;IAClB,sBAAsB;IACtB,mBAAmB;IACnB,yBAAyB;IACzB,yBAAyB;IACzB,yBAAyB;IACzB,yBAAyB;IACzB,yBAAyB;IACzB,yBAAyB;IACzB,0BAA0B;IAC1B,0BAA0B;IAC1B,0BAA0B;IAC1B,wBAAwB;IACxB,wBAAwB;IACxB,wBAAwB;IACxB,yBAAyB;IACzB,yBAAyB;IACzB,yBAAyB;IACzB,wBAAwB;IACxB,mBAAmB;IACnB,uBAAuB;IACvB,oBAAoB;IACpB,0BAA0B;IAC1B,0BAA0B;IAC1B,0BAA0B;IAC1B,yBAAyB;IACzB,yBAAyB;IACzB,yBAAyB;IACzB,2BAA2B;IAC3B,2BAA2B;IAC3B,2BAA2B;IAC3B,0BAA0B;IAC1B,0BAA0B;IAC1B,0BAA0B;IAC1B,0BAA0B;IAC1B,0BAA0B;IAC1B,0BAA0B;IAC1B,oBAAoB;IACpB,kBAAkB;IAClB,mBAAmB;IACnB,sBAAsB;IACtB,qBAAqB;IACrB,mBAAmB;IACnB,oBAAoB;IACpB,uBAAuB;AACzB"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/utils/remapMixamoAnimationToVrm.ts"],"sourcesContent":["import * as THREE from \"three\";\nimport { VRM, VRMHumanBoneName } from \"@pixiv/three-vrm\";\nimport { mixamoVRMRigMap } from \"./mixamoVRMRigMap\";\n\nexport function remapMixamoAnimationToVrm(\n  vrm: VRM,\n  asset: THREE.Group\n): THREE.AnimationClip {\n  const clip = THREE.AnimationClip.findByName(\n    asset.animations,\n    \"mixamo.com\"\n  )!.clone();\n\n  const tracks: THREE.KeyframeTrack[] = [];\n\n  const restRotationInverse = new THREE.Quaternion();\n  const parentRestWorldRotation = new THREE.Quaternion();\n  const _quatA = new THREE.Quaternion();\n  const _vec3 = new THREE.Vector3();\n\n  // Adjust with reference to hips height\n  const motionHipsHeight = asset.getObjectByName(\"mixamorigHips\")!.position.y;\n  const vrmHipsY = vrm.humanoid\n    ?.getNormalizedBoneNode(\"hips\")!\n    .getWorldPosition(_vec3).y;\n  const vrmRootY = vrm.scene.getWorldPosition(_vec3).y;\n  const vrmHipsHeight = Math.abs(vrmHipsY! - vrmRootY);\n  const hipsPositionScale = vrmHipsHeight / motionHipsHeight;\n\n  clip.tracks.forEach((track) => {\n    const trackSplitted = track.name.split(\".\");\n    const mixamoRigName = trackSplitted[0];\n    const vrmBoneName = mixamoVRMRigMap[mixamoRigName];\n    const vrmNodeName = vrm.humanoid?.getNormalizedBoneNode(\n      vrmBoneName as VRMHumanBoneName\n    )?.name;\n    const mixamoRigNode = asset.getObjectByName(mixamoRigName);\n\n    if (vrmNodeName != null) {\n      const propertyName = trackSplitted[1];\n\n      mixamoRigNode!.getWorldQuaternion(restRotationInverse).invert();\n      mixamoRigNode!.parent!.getWorldQuaternion(parentRestWorldRotation);\n\n      if (track instanceof THREE.QuaternionKeyframeTrack) {\n        for (let i = 0; i < track.values.length; i += 4) {\n          const flatQuaternion = track.values.slice(i, i + 4);\n\n          _quatA.fromArray(flatQuaternion);\n          _quatA\n            .premultiply(parentRestWorldRotation)\n            .multiply(restRotationInverse);\n          _quatA.toArray(flatQuaternion);\n\n          flatQuaternion.forEach((v, index) => {\n            track.values[index + i] = v;\n          });\n        }\n\n        tracks.push(\n          new THREE.QuaternionKeyframeTrack(\n            `${vrmNodeName}.${propertyName}`,\n            track.times,\n            track.values.map((v, i) =>\n              vrm.meta?.metaVersion === \"0\" && i % 2 === 0 ? -v : v\n            )\n          )\n        );\n      } else if (track instanceof THREE.VectorKeyframeTrack) {\n        const value = track.values.map(\n          (v, i) =>\n            (vrm.meta?.metaVersion === \"0\" && i % 3 !== 1 ? -v : v) *\n            hipsPositionScale\n        );\n        tracks.push(\n          new THREE.VectorKeyframeTrack(\n            `${vrmNodeName}.${propertyName}`,\n            track.times,\n            value\n          )\n        );\n      }\n    }\n  });\n\n  return new THREE.AnimationClip(\"vrmAnimation\", clip.duration, tracks);\n}\n"],"names":[],"mappings":";;;;AAAA;AAEA;;;AAEO,SAAS,0BACd,GAAQ,EACR,KAAkB;IAElB,MAAM,OAAO,gKAAmB,CAAC,UAAU,CACzC,MAAM,UAAU,EAChB,cACC,KAAK;IAER,MAAM,SAAgC,EAAE;IAExC,MAAM,sBAAsB,IAAI,6JAAgB;IAChD,MAAM,0BAA0B,IAAI,6JAAgB;IACpD,MAAM,SAAS,IAAI,6JAAgB;IACnC,MAAM,QAAQ,IAAI,0JAAa;IAE/B,uCAAuC;IACvC,MAAM,mBAAmB,MAAM,eAAe,CAAC,iBAAkB,QAAQ,CAAC,CAAC;IAC3E,MAAM,WAAW,IAAI,QAAQ,EACzB,sBAAsB,QACvB,iBAAiB,OAAO;IAC3B,MAAM,WAAW,IAAI,KAAK,CAAC,gBAAgB,CAAC,OAAO,CAAC;IACpD,MAAM,gBAAgB,KAAK,GAAG,CAAC,WAAY;IAC3C,MAAM,oBAAoB,gBAAgB;IAE1C,KAAK,MAAM,CAAC,OAAO,CAAC,CAAC;QACnB,MAAM,gBAAgB,MAAM,IAAI,CAAC,KAAK,CAAC;QACvC,MAAM,gBAAgB,aAAa,CAAC,EAAE;QACtC,MAAM,cAAc,2IAAe,CAAC,cAAc;QAClD,MAAM,cAAc,IAAI,QAAQ,EAAE,sBAChC,cACC;QACH,MAAM,gBAAgB,MAAM,eAAe,CAAC;QAE5C,IAAI,eAAe,MAAM;YACvB,MAAM,eAAe,aAAa,CAAC,EAAE;YAErC,cAAe,kBAAkB,CAAC,qBAAqB,MAAM;YAC7D,cAAe,MAAM,CAAE,kBAAkB,CAAC;YAE1C,IAAI,iBAAiB,0KAA6B,EAAE;gBAClD,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,MAAM,CAAC,MAAM,EAAE,KAAK,EAAG;oBAC/C,MAAM,iBAAiB,MAAM,MAAM,CAAC,KAAK,CAAC,GAAG,IAAI;oBAEjD,OAAO,SAAS,CAAC;oBACjB,OACG,WAAW,CAAC,yBACZ,QAAQ,CAAC;oBACZ,OAAO,OAAO,CAAC;oBAEf,eAAe,OAAO,CAAC,CAAC,GAAG;wBACzB,MAAM,MAAM,CAAC,QAAQ,EAAE,GAAG;oBAC5B;gBACF;gBAEA,OAAO,IAAI,CACT,IAAI,0KAA6B,CAC/B,GAAG,YAAY,CAAC,EAAE,cAAc,EAChC,MAAM,KAAK,EACX,MAAM,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,IACnB,IAAI,IAAI,EAAE,gBAAgB,OAAO,IAAI,MAAM,IAAI,CAAC,IAAI;YAI5D,OAAO,IAAI,iBAAiB,sKAAyB,EAAE;gBACrD,MAAM,QAAQ,MAAM,MAAM,CAAC,GAAG,CAC5B,CAAC,GAAG,IACF,CAAC,IAAI,IAAI,EAAE,gBAAgB,OAAO,IAAI,MAAM,IAAI,CAAC,IAAI,CAAC,IACtD;gBAEJ,OAAO,IAAI,CACT,IAAI,sKAAyB,CAC3B,GAAG,YAAY,CAAC,EAAE,cAAc,EAChC,MAAM,KAAK,EACX;YAGN;QACF;IACF;IAEA,OAAO,IAAI,gKAAmB,CAAC,gBAAgB,KAAK,QAAQ,EAAE;AAChE"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/utils/boneManipulation.ts"],"sourcesContent":["import * as THREE from \"three\";\nimport { VRM } from \"@pixiv/three-vrm\";\nimport { TransformControls } from \"three/addons/controls/TransformControls.js\";\n\nexport type BoneManipulationMode = \"off\" | \"ik\" | \"fk\";\n\ntype HumanBoneName =\n  | \"hips\"\n  | \"spine\"\n  | \"chest\"\n  | \"upperChest\"\n  | \"neck\"\n  | \"head\"\n  | \"leftShoulder\"\n  | \"leftUpperArm\"\n  | \"leftLowerArm\"\n  | \"leftHand\"\n  | \"rightShoulder\"\n  | \"rightUpperArm\"\n  | \"rightLowerArm\"\n  | \"rightHand\"\n  | \"leftUpperLeg\"\n  | \"leftLowerLeg\"\n  | \"leftFoot\"\n  | \"rightUpperLeg\"\n  | \"rightLowerLeg\"\n  | \"rightFoot\";\n\nexport class BoneManipulationController {\n  private vrm: VRM;\n  private scene: THREE.Scene;\n  private camera: THREE.Camera;\n  private renderer: THREE.WebGLRenderer;\n  private mode: BoneManipulationMode = \"off\";\n\n  // Visualization\n  private boneHelpers: Map<string, THREE.Mesh> = new Map();\n  private boneLines: THREE.LineSegments | null = null;\n  private helperGroup: THREE.Group;\n\n  // Interaction\n  private transformControl: TransformControls | null = null;\n  private raycaster: THREE.Raycaster = new THREE.Raycaster();\n  private mouse: THREE.Vector2 = new THREE.Vector2();\n\n  // IK\n  private ikTargets: Map<string, THREE.Vector3> = new Map();\n\n  constructor(\n    vrm: VRM,\n    scene: THREE.Scene,\n    camera: THREE.Camera,\n    renderer: THREE.WebGLRenderer\n  ) {\n    this.vrm = vrm;\n    this.scene = scene;\n    this.camera = camera;\n    this.renderer = renderer;\n    this.helperGroup = new THREE.Group();\n    this.helperGroup.name = \"BoneManipulationHelpers\";\n    this.scene.add(this.helperGroup);\n  }\n\n  setMode(mode: BoneManipulationMode) {\n    this.cleanup();\n    this.mode = mode;\n\n    if (mode === \"fk\") {\n      this.setupFKMode();\n    } else if (mode === \"ik\") {\n      this.setupIKMode();\n    }\n  }\n\n  private setupFKMode() {\n    const humanoid = this.vrm.humanoid;\n    if (!humanoid) return;\n\n    // Create bone helpers (spheres at each joint)\n    const boneNames: HumanBoneName[] = [\n      \"hips\",\n      \"spine\",\n      \"chest\",\n      \"upperChest\",\n      \"neck\",\n      \"head\",\n      \"leftShoulder\",\n      \"leftUpperArm\",\n      \"leftLowerArm\",\n      \"leftHand\",\n      \"rightShoulder\",\n      \"rightUpperArm\",\n      \"rightLowerArm\",\n      \"rightHand\",\n      \"leftUpperLeg\",\n      \"leftLowerLeg\",\n      \"leftFoot\",\n      \"rightUpperLeg\",\n      \"rightLowerLeg\",\n      \"rightFoot\",\n    ];\n\n    boneNames.forEach((boneName) => {\n      const bone = humanoid.getNormalizedBoneNode(boneName);\n      if (bone) {\n        const geometry = new THREE.SphereGeometry(0.03, 16, 16);\n        const material = new THREE.MeshBasicMaterial({\n          color: 0x00ff00,\n          transparent: true,\n          opacity: 0.7,\n          depthTest: false,\n        });\n        const sphere = new THREE.Mesh(geometry, material);\n        sphere.name = boneName;\n        sphere.userData.boneName = boneName;\n\n        // Position sphere at bone location\n        const worldPos = new THREE.Vector3();\n        bone.getWorldPosition(worldPos);\n        sphere.position.copy(worldPos);\n\n        this.boneHelpers.set(boneName, sphere);\n        this.helperGroup.add(sphere);\n      }\n    });\n\n    // Create bone lines (skeleton visualization)\n    this.createBoneLines();\n\n    // Setup TransformControls for rotation\n    this.transformControl = new TransformControls(\n      this.camera,\n      this.renderer.domElement\n    );\n    this.transformControl.setMode(\"rotate\");\n    this.transformControl.setSize(0.5);\n    this.transformControl.setSpace(\"local\"); // Use local space for bone rotations\n    this.transformControl.showX = true;\n    this.transformControl.showY = true;\n    this.transformControl.showZ = true;\n    this.transformControl.addEventListener(\"dragging-changed\", (event) => {\n      // Disable orbit controls when dragging\n      this.renderer.domElement.dispatchEvent(\n        new CustomEvent(\"transform-dragging\", { detail: event.value })\n      );\n    });\n\n    // TransformControls has an internal _root Object3D that needs to be added to scene\n    const root = (this.transformControl as unknown as { _root: THREE.Object3D })\n      ._root;\n    if (root) {\n      this.scene.add(root);\n    }\n\n    // Add click listener for bone selection\n    this.renderer.domElement.addEventListener(\"click\", this.onFKClick);\n  }\n\n  private setupIKMode() {\n    const humanoid = this.vrm.humanoid;\n    if (!humanoid) return;\n\n    // Create IK end effectors (hands and feet)\n    const ikBones: Array<{ name: HumanBoneName; color: number }> = [\n      { name: \"leftHand\", color: 0xff0000 },\n      { name: \"rightHand\", color: 0x0000ff },\n      { name: \"leftFoot\", color: 0xffff00 },\n      { name: \"rightFoot\", color: 0x00ffff },\n    ];\n\n    ikBones.forEach(({ name, color }) => {\n      const bone = humanoid.getNormalizedBoneNode(name);\n      if (bone) {\n        const geometry = new THREE.SphereGeometry(0.05, 16, 16);\n        const material = new THREE.MeshBasicMaterial({\n          color,\n          transparent: true,\n          opacity: 0.8,\n          depthTest: false,\n        });\n        const sphere = new THREE.Mesh(geometry, material);\n        sphere.name = `ik_${name}`;\n        sphere.userData.ikBoneName = name;\n\n        const worldPos = new THREE.Vector3();\n        bone.getWorldPosition(worldPos);\n        sphere.position.copy(worldPos);\n\n        this.boneHelpers.set(name, sphere);\n        this.helperGroup.add(sphere);\n      }\n    });\n\n    // Create bone lines\n    this.createBoneLines();\n\n    // Setup TransformControls for dragging\n    this.transformControl = new TransformControls(\n      this.camera,\n      this.renderer.domElement\n    );\n    this.transformControl.setMode(\"translate\");\n    this.transformControl.setSize(0.8);\n    this.transformControl.setSpace(\"world\"); // Use world space for IK targets\n    this.transformControl.showX = true;\n    this.transformControl.showY = true;\n    this.transformControl.showZ = true;\n    this.transformControl.addEventListener(\"dragging-changed\", (event) => {\n      this.renderer.domElement.dispatchEvent(\n        new CustomEvent(\"transform-dragging\", { detail: event.value })\n      );\n    });\n    this.transformControl.addEventListener(\"objectChange\", this.onIKTransform);\n\n    // TransformControls has an internal _root Object3D that needs to be added to scene\n    const root = (this.transformControl as unknown as { _root: THREE.Object3D })\n      ._root;\n    if (root) {\n      this.scene.add(root);\n    }\n\n    // Add click listener for IK helper selection\n    this.renderer.domElement.addEventListener(\"click\", this.onIKClick);\n  }\n\n  private onFKClick = (event: MouseEvent) => {\n    // Calculate mouse position in normalized device coordinates\n    const rect = this.renderer.domElement.getBoundingClientRect();\n    this.mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\n    this.mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;\n\n    // Raycast to find clicked bone helper\n    this.raycaster.setFromCamera(this.mouse, this.camera);\n    const intersects = this.raycaster.intersectObjects(\n      Array.from(this.boneHelpers.values())\n    );\n\n    if (intersects.length > 0) {\n      const clicked = intersects[0].object as THREE.Mesh;\n      const boneName = clicked.userData.boneName as string;\n\n      // Highlight selected bone\n      this.boneHelpers.forEach((helper, name) => {\n        (helper.material as THREE.MeshBasicMaterial).color.setHex(\n          name === boneName ? 0xffff00 : 0x00ff00\n        );\n      });\n\n      // Attach transform control to the bone itself\n      const bone = this.vrm.humanoid?.getNormalizedBoneNode(\n        boneName as HumanBoneName\n      );\n      if (bone && this.transformControl) {\n        this.transformControl.attach(bone);\n      }\n    }\n  };\n\n  private onIKClick = (event: MouseEvent) => {\n    const rect = this.renderer.domElement.getBoundingClientRect();\n    this.mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;\n    this.mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;\n\n    this.raycaster.setFromCamera(this.mouse, this.camera);\n    const intersects = this.raycaster.intersectObjects(\n      Array.from(this.boneHelpers.values())\n    );\n\n    if (intersects.length > 0 && this.transformControl) {\n      const clicked = intersects[0].object;\n      this.transformControl.attach(clicked);\n    }\n  };\n\n  private onIKTransform = () => {\n    if (!this.transformControl?.object) return;\n\n    const helper = this.transformControl.object as THREE.Mesh;\n    const boneName = helper.userData.ikBoneName as string;\n\n    if (boneName) {\n      this.ikTargets.set(boneName, helper.position.clone());\n      this.solveIK(boneName);\n    }\n  };\n\n  private solveIK(endEffectorName: string) {\n    // CCD IK solver (Cyclic Coordinate Descent)\n    const humanoid = this.vrm.humanoid;\n    if (!humanoid) return;\n\n    const targetPos = this.ikTargets.get(endEffectorName);\n    if (!targetPos) return;\n\n    // Define bone chains for IK\n    const chains: Record<string, HumanBoneName[]> = {\n      leftHand: [\"leftUpperArm\", \"leftLowerArm\", \"leftHand\"],\n      rightHand: [\"rightUpperArm\", \"rightLowerArm\", \"rightHand\"],\n      leftFoot: [\"leftUpperLeg\", \"leftLowerLeg\", \"leftFoot\"],\n      rightFoot: [\"rightUpperLeg\", \"rightLowerLeg\", \"rightFoot\"],\n    };\n\n    const chain = chains[endEffectorName];\n    if (!chain) return;\n\n    // Get bones in chain\n    const bones = chain\n      .map((name) => humanoid.getNormalizedBoneNode(name))\n      .filter((bone): bone is THREE.Object3D => bone !== null);\n\n    if (bones.length < 2) return;\n\n    // Iterative CCD algorithm\n    const iterations = 10;\n    const threshold = 0.01;\n\n    for (let iter = 0; iter < iterations; iter++) {\n      // Work backwards from end effector\n      for (let i = bones.length - 2; i >= 0; i--) {\n        const bone = bones[i];\n        const endEffector = bones[bones.length - 1];\n\n        // Get positions in world space\n        const bonePos = new THREE.Vector3();\n        const endEffectorPos = new THREE.Vector3();\n        bone.getWorldPosition(bonePos);\n        endEffector.getWorldPosition(endEffectorPos);\n\n        // Check if we're close enough\n        const distance = endEffectorPos.distanceTo(targetPos);\n        if (distance < threshold) break;\n\n        // Calculate rotation needed\n        const toEnd = new THREE.Vector3()\n          .subVectors(endEffectorPos, bonePos)\n          .normalize();\n        const toTarget = new THREE.Vector3()\n          .subVectors(targetPos, bonePos)\n          .normalize();\n\n        // Calculate rotation quaternion\n        const rotationQuat = new THREE.Quaternion().setFromUnitVectors(\n          toEnd,\n          toTarget\n        );\n\n        // Apply rotation to bone\n        bone.quaternion.multiply(rotationQuat);\n      }\n    }\n  }\n\n  private createBoneLines() {\n    const humanoid = this.vrm.humanoid;\n    if (!humanoid) return;\n\n    const positions: number[] = [];\n\n    // Define bone connections (parent -> child)\n    const connections: Array<[HumanBoneName, HumanBoneName]> = [\n      [\"hips\", \"spine\"],\n      [\"spine\", \"chest\"],\n      [\"chest\", \"upperChest\"],\n      [\"upperChest\", \"neck\"],\n      [\"neck\", \"head\"],\n      [\"upperChest\", \"leftShoulder\"],\n      [\"leftShoulder\", \"leftUpperArm\"],\n      [\"leftUpperArm\", \"leftLowerArm\"],\n      [\"leftLowerArm\", \"leftHand\"],\n      [\"upperChest\", \"rightShoulder\"],\n      [\"rightShoulder\", \"rightUpperArm\"],\n      [\"rightUpperArm\", \"rightLowerArm\"],\n      [\"rightLowerArm\", \"rightHand\"],\n      [\"hips\", \"leftUpperLeg\"],\n      [\"leftUpperLeg\", \"leftLowerLeg\"],\n      [\"leftLowerLeg\", \"leftFoot\"],\n      [\"hips\", \"rightUpperLeg\"],\n      [\"rightUpperLeg\", \"rightLowerLeg\"],\n      [\"rightLowerLeg\", \"rightFoot\"],\n    ];\n\n    connections.forEach(([parent, child]) => {\n      const parentBone = humanoid.getNormalizedBoneNode(parent);\n      const childBone = humanoid.getNormalizedBoneNode(child);\n\n      if (parentBone && childBone) {\n        const parentPos = new THREE.Vector3();\n        const childPos = new THREE.Vector3();\n        parentBone.getWorldPosition(parentPos);\n        childBone.getWorldPosition(childPos);\n\n        positions.push(parentPos.x, parentPos.y, parentPos.z);\n        positions.push(childPos.x, childPos.y, childPos.z);\n      }\n    });\n\n    const geometry = new THREE.BufferGeometry();\n    geometry.setAttribute(\n      \"position\",\n      new THREE.Float32BufferAttribute(positions, 3)\n    );\n\n    const material = new THREE.LineBasicMaterial({\n      color: 0xffffff,\n      transparent: true,\n      opacity: 0.5,\n      depthTest: false,\n    });\n\n    this.boneLines = new THREE.LineSegments(geometry, material);\n    this.helperGroup.add(this.boneLines);\n  }\n\n  update() {\n    if (this.mode === \"off\") return;\n\n    // Update bone helper positions\n    this.boneHelpers.forEach((helper, boneName) => {\n      const bone = this.vrm.humanoid?.getNormalizedBoneNode(\n        boneName as HumanBoneName\n      );\n      if (bone) {\n        const worldPos = new THREE.Vector3();\n        bone.getWorldPosition(worldPos);\n        helper.position.copy(worldPos);\n      }\n    });\n\n    // Update bone lines\n    this.updateBoneLines();\n  }\n\n  private updateBoneLines() {\n    if (!this.boneLines) return;\n\n    const humanoid = this.vrm.humanoid;\n    if (!humanoid) return;\n\n    const positions: number[] = [];\n\n    const connections: Array<[HumanBoneName, HumanBoneName]> = [\n      [\"hips\", \"spine\"],\n      [\"spine\", \"chest\"],\n      [\"chest\", \"upperChest\"],\n      [\"upperChest\", \"neck\"],\n      [\"neck\", \"head\"],\n      [\"upperChest\", \"leftShoulder\"],\n      [\"leftShoulder\", \"leftUpperArm\"],\n      [\"leftUpperArm\", \"leftLowerArm\"],\n      [\"leftLowerArm\", \"leftHand\"],\n      [\"upperChest\", \"rightShoulder\"],\n      [\"rightShoulder\", \"rightUpperArm\"],\n      [\"rightUpperArm\", \"rightLowerArm\"],\n      [\"rightLowerArm\", \"rightHand\"],\n      [\"hips\", \"leftUpperLeg\"],\n      [\"leftUpperLeg\", \"leftLowerLeg\"],\n      [\"leftLowerLeg\", \"leftFoot\"],\n      [\"hips\", \"rightUpperLeg\"],\n      [\"rightUpperLeg\", \"rightLowerLeg\"],\n      [\"rightLowerLeg\", \"rightFoot\"],\n    ];\n\n    connections.forEach(([parent, child]) => {\n      const parentBone = humanoid.getNormalizedBoneNode(parent);\n      const childBone = humanoid.getNormalizedBoneNode(child);\n\n      if (parentBone && childBone) {\n        const parentPos = new THREE.Vector3();\n        const childPos = new THREE.Vector3();\n        parentBone.getWorldPosition(parentPos);\n        childBone.getWorldPosition(childPos);\n\n        positions.push(parentPos.x, parentPos.y, parentPos.z);\n        positions.push(childPos.x, childPos.y, childPos.z);\n      }\n    });\n\n    this.boneLines.geometry.setAttribute(\n      \"position\",\n      new THREE.Float32BufferAttribute(positions, 3)\n    );\n    this.boneLines.geometry.attributes.position.needsUpdate = true;\n  }\n\n  cleanup() {\n    // Remove all helpers\n    this.helperGroup.clear();\n    this.boneHelpers.clear();\n    this.boneLines = null;\n    this.ikTargets.clear();\n\n    // Remove transform control\n    if (this.transformControl) {\n      this.transformControl.detach();\n      this.transformControl.removeEventListener(\n        \"objectChange\",\n        this.onIKTransform\n      );\n\n      // Remove the internal _root from scene\n      const root = (\n        this.transformControl as unknown as { _root: THREE.Object3D }\n      )._root;\n      if (root) {\n        this.scene.remove(root);\n      }\n\n      this.transformControl.dispose();\n      this.transformControl = null;\n    }\n\n    // Remove event listeners\n    this.renderer.domElement.removeEventListener(\"click\", this.onFKClick);\n    this.renderer.domElement.removeEventListener(\"click\", this.onIKClick);\n  }\n\n  dispose() {\n    this.cleanup();\n    this.scene.remove(this.helperGroup);\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 652, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/VRMViewer.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, forwardRef, useImperativeHandle } from \"react\";\nimport * as THREE from \"three\";\nimport { GLTFLoader, GLTF } from \"three/addons/loaders/GLTFLoader.js\";\nimport { OrbitControls } from \"three/addons/controls/OrbitControls.js\";\nimport { FBXLoader } from \"three/addons/loaders/FBXLoader.js\";\nimport { VRMLoaderPlugin, VRMUtils } from \"@pixiv/three-vrm\";\nimport type { VRM } from \"@pixiv/three-vrm\";\nimport { remapMixamoAnimationToVrm } from \"../utils/remapMixamoAnimationToVrm\";\nimport {\n  BoneManipulationController,\n  type BoneManipulationMode,\n} from \"../utils/boneManipulation\";\n\ninterface PoseData {\n  name?: string;\n  code?: string;\n  vrmVersion?: string;\n  data?: Record<string, { rotation: [number, number, number, number] }>;\n}\n\nexport interface VRMViewerRef {\n  setExpression: (name: string, value: number) => void;\n  loadVRM: (\n    arrayBufferOrUrl: ArrayBuffer | string,\n    onProgress?: (progress: number) => void\n  ) => Promise<void>;\n  clearScene: () => void;\n  loadAnimation: (animationPath: string) => Promise<void>;\n  setAnimationSpeed: (speed: number) => void;\n  setCameraControlsEnabled: (enabled: boolean) => void;\n  resetCameraPosition: () => void;\n  resetCharacterPosition: () => void;\n  setCameraFollowCharacter: (enabled: boolean) => void;\n  setHideGridAxes: (hide: boolean) => void;\n  loadPose: (poseData: PoseData) => void;\n  getExpressions: () => Array<{ name: string; value: number }>;\n  getShapeKeys: () => Array<{ name: string; value: number }>;\n  getSpringBones: () => Array<{\n    name: string;\n    settings: {\n      dragForce: number;\n      gravityPower: number;\n      hitRadius: number;\n      stiffness: number;\n      gravityDir: { x: number; y: number; z: number };\n    };\n  }>;\n  setShapeKey: (name: string, value: number) => void;\n  getCurrentPoseData: () => PoseData | null;\n  setBoneManipulationMode: (mode: BoneManipulationMode) => void;\n}\n\nexport const VRMViewer = forwardRef<VRMViewerRef>((_, ref) => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const vrmRef = useRef<VRM | null>(null);\n  const sceneRef = useRef<THREE.Scene | null>(null);\n  const loaderRef = useRef<GLTFLoader | null>(null);\n  const activeBlobUrlsRef = useRef<Set<string>>(new Set());\n  const cameraRef = useRef<THREE.PerspectiveCamera | null>(null);\n  const controlsRef = useRef<OrbitControls | null>(null);\n  const loadingIdRef = useRef<number>(0);\n  const mixerRef = useRef<THREE.AnimationMixer | null>(null);\n  const currentAnimationRef = useRef<THREE.AnimationAction | null>(null);\n  const loadedAnimationsRef = useRef<Map<string, THREE.AnimationClip>>(\n    new Map()\n  );\n  const initialCameraPositionRef = useRef<THREE.Vector3>(\n    new THREE.Vector3(0, 1, 5)\n  );\n  const initialCameraTargetRef = useRef<THREE.Vector3>(\n    new THREE.Vector3(0, 1, 0)\n  );\n  const characterOriginRef = useRef<THREE.Vector3>(new THREE.Vector3(0, 1, 0));\n  const cameraFollowCharacterRef = useRef<boolean>(false);\n  const gridHelperRef = useRef<THREE.GridHelper | null>(null);\n  const axesHelperRef = useRef<THREE.AxesHelper | null>(null);\n  const cameraFollowOffsetRef = useRef<THREE.Vector3>(\n    new THREE.Vector3(0, 0, 0)\n  );\n  const originalFollowTargetRef = useRef<THREE.Vector3>(\n    new THREE.Vector3(0, 1, 0)\n  );\n  const isRightMouseDownRef = useRef<boolean>(false);\n  const lastMousePositionRef = useRef<{ x: number; y: number }>({ x: 0, y: 0 });\n  const boneManipulationControllerRef =\n    useRef<BoneManipulationController | null>(null);\n  const rendererRef = useRef<THREE.WebGLRenderer | null>(null);\n\n  useImperativeHandle(ref, () => ({\n    setExpression: (name: string, value: number) => {\n      if (vrmRef.current?.expressionManager) {\n        vrmRef.current.expressionManager.setValue(name, value);\n      }\n    },\n    setCameraControlsEnabled: (enabled: boolean) => {\n      if (controlsRef.current) {\n        controlsRef.current.enableDamping = enabled;\n        if (!enabled) {\n          // Reset damping immediately when disabled\n          controlsRef.current.update();\n        }\n      }\n    },\n    resetCameraPosition: () => {\n      if (controlsRef.current && cameraRef.current) {\n        // Reset camera to initial position and target\n        cameraRef.current.position.copy(initialCameraPositionRef.current);\n        controlsRef.current.target.copy(initialCameraTargetRef.current);\n        controlsRef.current.update();\n      }\n    },\n    resetCharacterPosition: () => {\n      // Stop any playing animation (empty string stops animation)\n      if (currentAnimationRef.current) {\n        currentAnimationRef.current.stop();\n        currentAnimationRef.current = null;\n      }\n\n      // Reset VRM position to origin\n      if (vrmRef.current?.scene) {\n        vrmRef.current.scene.position.set(0, 0, 0);\n        vrmRef.current.scene.rotation.set(0, 0, 0);\n      }\n\n      // Reset all bone rotations to T-pose\n      if (vrmRef.current?.humanoid) {\n        const humanoid = vrmRef.current.humanoid;\n        const boneNames = [\n          \"hips\",\n          \"spine\",\n          \"chest\",\n          \"upperChest\",\n          \"neck\",\n          \"head\",\n          \"leftShoulder\",\n          \"leftUpperArm\",\n          \"leftLowerArm\",\n          \"leftHand\",\n          \"rightShoulder\",\n          \"rightUpperArm\",\n          \"rightLowerArm\",\n          \"rightHand\",\n          \"leftUpperLeg\",\n          \"leftLowerLeg\",\n          \"leftFoot\",\n          \"rightUpperLeg\",\n          \"rightLowerLeg\",\n          \"rightFoot\",\n        ] as const;\n\n        boneNames.forEach((boneName) => {\n          const bone = humanoid.getNormalizedBoneNode(boneName);\n          if (bone) {\n            bone.rotation.set(0, 0, 0);\n          }\n        });\n      }\n    },\n    setCameraFollowCharacter: (enabled: boolean) => {\n      cameraFollowCharacterRef.current = enabled;\n      if (enabled) {\n        // Reset offset to zero when enabling\n        cameraFollowOffsetRef.current.set(0, 0, 0);\n        // Store original target position\n        if (vrmRef.current) {\n          const hips = vrmRef.current.humanoid?.getNormalizedBoneNode(\"hips\");\n          if (hips) {\n            const hipsPosition = new THREE.Vector3();\n            hips.getWorldPosition(hipsPosition);\n            originalFollowTargetRef.current.copy(hipsPosition);\n          }\n        }\n      }\n    },\n    setHideGridAxes: (hide: boolean) => {\n      if (gridHelperRef.current) {\n        gridHelperRef.current.visible = !hide;\n      }\n      if (axesHelperRef.current) {\n        axesHelperRef.current.visible = !hide;\n      }\n    },\n    loadAnimation: async (animationPath: string) => {\n      if (!vrmRef.current) {\n        throw new Error(\"VRM not loaded\");\n      }\n\n      return new Promise((resolve, reject) => {\n        // Check if animation is already loaded\n        if (loadedAnimationsRef.current.has(animationPath)) {\n          const clip = loadedAnimationsRef.current.get(animationPath)!;\n          playAnimation(clip);\n          resolve();\n          return;\n        }\n\n        // Load new animation\n        const fbxLoader = new FBXLoader();\n        fbxLoader.load(\n          animationPath,\n          (fbx) => {\n            console.log(\"ðŸŽ¬ Animation FBX loaded:\", animationPath);\n\n            // Remap Mixamo animation to VRM\n            const vrmAnimationClip = remapMixamoAnimationToVrm(\n              vrmRef.current!,\n              fbx\n            );\n\n            // Cache the animation\n            loadedAnimationsRef.current.set(animationPath, vrmAnimationClip);\n\n            // Play the animation\n            playAnimation(vrmAnimationClip);\n\n            console.log(\"âœ¨ Animation loaded and playing:\", animationPath);\n            resolve();\n          },\n          undefined,\n          (error) => {\n            console.error(\"Error loading animation:\", error);\n            reject(error);\n          }\n        );\n      });\n    },\n    setAnimationSpeed: (speed: number) => {\n      if (currentAnimationRef.current) {\n        currentAnimationRef.current.timeScale = speed;\n      }\n    },\n    clearScene: () => {\n      if (!sceneRef.current) return;\n\n      // Simply remove VRM models from scene (like R3F does on unmount)\n      const childrenToRemove = sceneRef.current.children.filter(\n        (child) =>\n          !(child instanceof THREE.Light) &&\n          !(child instanceof THREE.GridHelper) &&\n          !(child instanceof THREE.AxesHelper)\n      );\n\n      childrenToRemove.forEach((child) => {\n        sceneRef.current?.remove(child);\n      });\n\n      vrmRef.current = null;\n      console.log(\"âœ… Scene cleared (models removed, textures preserved)\");\n    },\n    loadVRM: async (\n      arrayBufferOrUrl: ArrayBuffer | string,\n      onProgress?: (progress: number) => void\n    ) => {\n      return new Promise((resolve, reject) => {\n        if (!loaderRef.current || !sceneRef.current) {\n          reject(new Error(\"VRM loader not initialized\"));\n          return;\n        }\n\n        // Increment loading ID to cancel any previous loads\n        loadingIdRef.current += 1;\n        const currentLoadingId = loadingIdRef.current;\n        console.log(\"ðŸ”„ Starting model load #\" + currentLoadingId);\n\n        // Check model size on mobile devices\n        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);\n        if (isMobile && arrayBufferOrUrl instanceof ArrayBuffer) {\n          const sizeInMB = arrayBufferOrUrl.byteLength / (1024 * 1024);\n          console.log(`ðŸ“¦ Model size: ${sizeInMB.toFixed(2)}MB`);\n          if (sizeInMB > 15) {\n            // Warning for large models on mobile\n            console.warn(\n              `âš ï¸ Large model (${sizeInMB.toFixed(\n                1\n              )}MB) may cause performance issues on mobile`\n            );\n          }\n        }\n\n        // FIRST: Revoke old blob URLs from previous uploads\n        // This is safe because we're about to clear the old model\n        if (activeBlobUrlsRef.current.size > 0) {\n          console.log(\n            \"ðŸ—‘ï¸ Revoking\",\n            activeBlobUrlsRef.current.size,\n            \"old blob URL(s)...\"\n          );\n          activeBlobUrlsRef.current.forEach((blobUrl) => {\n            URL.revokeObjectURL(blobUrl);\n          });\n          activeBlobUrlsRef.current.clear();\n        }\n\n        // Clear the scene - remove all children except lights and helpers\n        const childrenToRemove = sceneRef.current.children.filter(\n          (child) =>\n            !(child instanceof THREE.Light) &&\n            !(child instanceof THREE.GridHelper) &&\n            !(child instanceof THREE.AxesHelper)\n        );\n\n        childrenToRemove.forEach((child) => {\n          sceneRef.current?.remove(child);\n          // DO NOT dispose here - textures might still be in use by WebGL\n          // Let the renderer manage texture lifecycle\n        });\n\n        vrmRef.current = null;\n\n        // If empty string, just clear and resolve\n        if (typeof arrayBufferOrUrl === \"string\" && arrayBufferOrUrl === \"\") {\n          console.log(\"Scene cleared (empty URL provided)\");\n          resolve();\n          return;\n        }\n\n        if (typeof arrayBufferOrUrl === \"string\") {\n          // Load from URL (for public assets)\n          loaderRef.current.load(\n            arrayBufferOrUrl,\n            handleVRMLoad,\n            (progress) => {\n              const percent = Math.round(\n                100.0 * (progress.loaded / progress.total)\n              );\n              console.log(\"Loading model...\", percent, \"%\");\n              onProgress?.(percent);\n            },\n            (error) => {\n              console.error(\"Error loading VRM from URL:\", error);\n              reject(error);\n            }\n          );\n        } else {\n          // Parse from ArrayBuffer (for uploaded files)\n          console.log(\"Loading VRM from ArrayBuffer...\");\n\n          // Create blob URL and track it\n          // WebGL needs continuous access to textures during model lifetime\n          const blob = new Blob([arrayBufferOrUrl], {\n            type: \"model/gltf-binary\",\n          });\n          const blobUrl = URL.createObjectURL(blob);\n\n          // Track this blob URL for later cleanup\n          activeBlobUrlsRef.current.add(blobUrl);\n          console.log(\n            \"Created and tracked blob URL:\",\n            blobUrl.substring(0, 50) + \"...\"\n          );\n\n          loaderRef.current.load(\n            blobUrl,\n            handleVRMLoad,\n            (progress) => {\n              const percent = Math.round(\n                100.0 * (progress.loaded / progress.total)\n              );\n              console.log(\"Loading uploaded model...\", percent, \"%\");\n              onProgress?.(percent);\n            },\n            (error) => {\n              console.error(\"Error loading VRM from buffer:\", error);\n              reject(error);\n            }\n          );\n        }\n\n        function handleVRMLoad(gltf: GLTF) {\n          // Check if this load is still current\n          if (currentLoadingId !== loadingIdRef.current) {\n            console.log(\n              \"âš ï¸ Ignoring outdated model load #\" +\n                currentLoadingId +\n                \" (current: #\" +\n                loadingIdRef.current +\n                \")\"\n            );\n            reject(new Error(\"Model load cancelled - newer load started\"));\n            return;\n          }\n\n          const vrm = gltf.userData.vrm as VRM;\n\n          // Optimize VRM model (from reference project)\n          console.log(\"ðŸ”§ Optimizing VRM model...\");\n          VRMUtils.removeUnnecessaryVertices(gltf.scene);\n          VRMUtils.removeUnnecessaryJoints(gltf.scene);\n\n          vrm.scene.traverse((obj: THREE.Object3D) => {\n            obj.frustumCulled = false;\n          });\n\n          sceneRef.current?.add(vrm.scene);\n          vrmRef.current = vrm;\n\n          // Auto-adjust camera to fit the model\n          if (cameraRef.current && controlsRef.current) {\n            // Calculate bounding box of the model\n            const box = new THREE.Box3().setFromObject(vrm.scene);\n            const size = box.getSize(new THREE.Vector3());\n            const center = box.getCenter(new THREE.Vector3());\n\n            // Calculate optimal camera distance\n            const maxDim = Math.max(size.x, size.y, size.z);\n            const fov = cameraRef.current.fov * (Math.PI / 180);\n            let cameraDistance = Math.abs(maxDim / Math.sin(fov / 2));\n            cameraDistance *= 1.5; // Add some padding\n\n            // Position camera to look at model center\n            const cameraHeight = center.y;\n            cameraRef.current.position.set(\n              center.x,\n              cameraHeight,\n              center.z + cameraDistance\n            );\n\n            // Update controls target to model center\n            controlsRef.current.target.copy(center);\n            controlsRef.current.update();\n\n            // Store initial camera position and target for reset feature\n            initialCameraPositionRef.current.copy(cameraRef.current.position);\n            initialCameraTargetRef.current.copy(controlsRef.current.target);\n\n            // Store character origin for camera follow feature\n            characterOriginRef.current.copy(center);\n\n            console.log(\"ðŸ“ Model bounds:\", {\n              size: {\n                x: size.x.toFixed(2),\n                y: size.y.toFixed(2),\n                z: size.z.toFixed(2),\n              },\n              center: {\n                x: center.x.toFixed(2),\n                y: center.y.toFixed(2),\n                z: center.z.toFixed(2),\n              },\n              cameraDistance: cameraDistance.toFixed(2),\n            });\n          }\n\n          // Reset all expressions to 0\n          if (vrm.expressionManager) {\n            for (const expName of Object.keys(\n              vrm.expressionManager.expressionMap\n            )) {\n              vrm.expressionManager.setValue(expName, 0);\n            }\n          }\n\n          console.log(\n            \"Available Expressions:\",\n            vrm.expressionManager?.expressionMap\n          );\n          console.log(\"âœ… VRM model loaded successfully!\");\n\n          resolve();\n        }\n      });\n    },\n    loadPose: (poseData: PoseData) => {\n      if (!vrmRef.current) return;\n\n      // Apply pose data to VRM bones\n      if (poseData.data) {\n        Object.entries(poseData.data).forEach(([boneName, boneData]) => {\n          const humanBone = vrmRef.current?.humanoid?.getNormalizedBoneNode(\n            boneName as keyof typeof vrmRef.current.humanoid.humanBones\n          );\n          if (humanBone && boneData.rotation) {\n            const [x, y, z, w] = boneData.rotation;\n            humanBone.quaternion.set(x, y, z, w);\n          }\n        });\n      }\n    },\n    getExpressions: () => {\n      if (!vrmRef.current?.expressionManager) return [];\n\n      const expressions: Array<{ name: string; value: number }> = [];\n      const manager = vrmRef.current.expressionManager;\n\n      // Get all expression names from the manager\n      const expressionMap = (\n        manager as {\n          expressionMap: Map<string, unknown> | Record<string, unknown>;\n        }\n      ).expressionMap;\n\n      // Handle both Map and Object types\n      if (expressionMap instanceof Map) {\n        for (const [name] of expressionMap.entries()) {\n          expressions.push({\n            name,\n            value: manager.getValue(name) || 0,\n          });\n        }\n      } else if (expressionMap && typeof expressionMap === \"object\") {\n        // It's a plain object\n        for (const name of Object.keys(expressionMap)) {\n          expressions.push({\n            name,\n            value: manager.getValue(name) || 0,\n          });\n        }\n      }\n\n      return expressions;\n    },\n    getShapeKeys: () => {\n      // Get actual morph targets (blend shapes) from meshes\n      if (!vrmRef.current) return [];\n\n      const shapeKeys: Array<{ name: string; value: number }> = [];\n      const morphTargetNames = new Set<string>();\n\n      // Traverse the scene to find all meshes with morph targets\n      type MeshWithMorphTargets = THREE.Mesh & {\n        morphTargetDictionary?: Record<string, number>;\n        morphTargetInfluences?: number[];\n      };\n\n      vrmRef.current.scene.traverse((obj: THREE.Object3D) => {\n        if (\"isMesh\" in obj && obj.isMesh) {\n          const mesh = obj as MeshWithMorphTargets;\n          if (mesh.morphTargetDictionary && mesh.morphTargetInfluences) {\n            // Get all morph target names from this mesh\n            Object.keys(mesh.morphTargetDictionary).forEach((name) => {\n              morphTargetNames.add(name);\n            });\n          }\n        }\n      });\n\n      // Get the first mesh with morph targets to read values\n      let meshDict: Record<string, number> | undefined;\n      let meshInfluences: number[] | undefined;\n\n      vrmRef.current.scene.traverse((obj: THREE.Object3D) => {\n        if (!meshDict && \"isMesh\" in obj && obj.isMesh) {\n          const mesh = obj as MeshWithMorphTargets;\n          if (mesh.morphTargetDictionary && mesh.morphTargetInfluences) {\n            meshDict = mesh.morphTargetDictionary;\n            meshInfluences = mesh.morphTargetInfluences;\n          }\n        }\n      });\n\n      // Build the shape keys list\n      if (meshDict && meshInfluences) {\n        morphTargetNames.forEach((name) => {\n          const index = meshDict![name];\n          const value = meshInfluences![index] || 0;\n          shapeKeys.push({ name, value });\n        });\n      }\n\n      return shapeKeys;\n    },\n    getSpringBones: () => {\n      if (!vrmRef.current) return [];\n\n      const springBones: Array<{\n        name: string;\n        settings: {\n          dragForce: number;\n          gravityPower: number;\n          hitRadius: number;\n          stiffness: number;\n          gravityDir: { x: number; y: number; z: number };\n        };\n      }> = [];\n\n      const vrm = vrmRef.current;\n      const springBoneManager = (\n        vrm as {\n          springBoneManager?: { _sortedJoints?: unknown[]; joints?: unknown[] };\n        }\n      ).springBoneManager;\n\n      if (springBoneManager) {\n        // Use _sortedJoints which contains all the spring bone joints\n        const joints =\n          (\n            springBoneManager as {\n              _sortedJoints?: unknown[];\n              joints?: unknown[];\n            }\n          )._sortedJoints ||\n          (\n            springBoneManager as {\n              _sortedJoints?: unknown[];\n              joints?: unknown[];\n            }\n          ).joints ||\n          [];\n\n        if (Array.isArray(joints) && joints.length > 0) {\n          // Group joints by their root bone to avoid duplicates\n          const processedBones = new Set<string>();\n\n          joints.forEach((jointData: unknown, index: number) => {\n            const joint = jointData as {\n              bone?: { name?: string };\n              _bone?: { name?: string };\n              settings?: {\n                dragForce?: number;\n                gravityPower?: number;\n                hitRadius?: number;\n                stiffness?: number;\n                gravityDir?: { x?: number; y?: number; z?: number };\n              };\n              _settings?: {\n                dragForce?: number;\n                gravityPower?: number;\n                hitRadius?: number;\n                stiffness?: number;\n                gravityDir?: { x?: number; y?: number; z?: number };\n              };\n            };\n            const bone = joint.bone || joint._bone;\n            const settings = joint.settings || joint._settings;\n\n            if (bone && settings) {\n              const boneName = bone.name || `Spring Bone ${index + 1}`;\n\n              // Only add unique bones\n              if (!processedBones.has(boneName)) {\n                processedBones.add(boneName);\n\n                springBones.push({\n                  name: boneName,\n                  settings: {\n                    dragForce: settings.dragForce ?? 0.5,\n                    gravityPower: settings.gravityPower ?? 0,\n                    hitRadius: settings.hitRadius ?? 0.02,\n                    stiffness: settings.stiffness ?? 1,\n                    gravityDir: {\n                      x: settings.gravityDir?.x ?? 0,\n                      y: settings.gravityDir?.y ?? -1,\n                      z: settings.gravityDir?.z ?? 0,\n                    },\n                  },\n                });\n              }\n            }\n          });\n        }\n      }\n\n      return springBones;\n    },\n    setShapeKey: (name: string, value: number) => {\n      if (!vrmRef.current) return;\n\n      // Apply the morph target value to all meshes that have it\n      vrmRef.current.scene.traverse((obj: THREE.Object3D) => {\n        if (\"isMesh\" in obj && obj.isMesh) {\n          const mesh = obj as THREE.Mesh & {\n            morphTargetDictionary?: Record<string, number>;\n            morphTargetInfluences?: number[];\n          };\n          if (mesh.morphTargetDictionary && mesh.morphTargetInfluences) {\n            const index = mesh.morphTargetDictionary[name];\n            if (index !== undefined) {\n              mesh.morphTargetInfluences[index] = value;\n            }\n          }\n        }\n      });\n    },\n    getCurrentPoseData: () => {\n      if (!vrmRef.current) return null;\n\n      const poseData: PoseData = {\n        name: \"Custom Pose\",\n        code: crypto.randomUUID(),\n        vrmVersion: \"0\",\n        data: {},\n      };\n\n      // Get all humanoid bones\n      const humanoid = vrmRef.current.humanoid;\n      if (humanoid && poseData.data) {\n        const boneNames = [\n          \"hips\",\n          \"spine\",\n          \"chest\",\n          \"upperChest\",\n          \"neck\",\n          \"head\",\n          \"leftShoulder\",\n          \"leftUpperArm\",\n          \"leftLowerArm\",\n          \"leftHand\",\n          \"rightShoulder\",\n          \"rightUpperArm\",\n          \"rightLowerArm\",\n          \"rightHand\",\n          \"leftUpperLeg\",\n          \"leftLowerLeg\",\n          \"leftFoot\",\n          \"leftToes\",\n          \"rightUpperLeg\",\n          \"rightLowerLeg\",\n          \"rightFoot\",\n          \"rightToes\",\n          \"leftEye\",\n          \"rightEye\",\n          \"jaw\",\n          \"leftThumbProximal\",\n          \"leftThumbIntermediate\",\n          \"leftThumbDistal\",\n          \"leftIndexProximal\",\n          \"leftIndexIntermediate\",\n          \"leftIndexDistal\",\n          \"leftMiddleProximal\",\n          \"leftMiddleIntermediate\",\n          \"leftMiddleDistal\",\n          \"leftRingProximal\",\n          \"leftRingIntermediate\",\n          \"leftRingDistal\",\n          \"leftLittleProximal\",\n          \"leftLittleIntermediate\",\n          \"leftLittleDistal\",\n          \"rightThumbProximal\",\n          \"rightThumbIntermediate\",\n          \"rightThumbDistal\",\n          \"rightIndexProximal\",\n          \"rightIndexIntermediate\",\n          \"rightIndexDistal\",\n          \"rightMiddleProximal\",\n          \"rightMiddleIntermediate\",\n          \"rightMiddleDistal\",\n          \"rightRingProximal\",\n          \"rightRingIntermediate\",\n          \"rightRingDistal\",\n          \"rightLittleProximal\",\n          \"rightLittleIntermediate\",\n          \"rightLittleDistal\",\n        ];\n\n        boneNames.forEach((boneName) => {\n          const bone = humanoid.getNormalizedBoneNode(\n            boneName as keyof typeof humanoid.humanBones\n          );\n          if (bone && poseData.data) {\n            poseData.data[boneName] = {\n              rotation: [\n                bone.quaternion.x,\n                bone.quaternion.y,\n                bone.quaternion.z,\n                bone.quaternion.w,\n              ],\n            };\n          }\n        });\n      }\n\n      return poseData;\n    },\n    setBoneManipulationMode: (mode: BoneManipulationMode) => {\n      if (\n        !vrmRef.current ||\n        !sceneRef.current ||\n        !cameraRef.current ||\n        !rendererRef.current\n      )\n        return;\n\n      // Create controller if it doesn't exist\n      if (!boneManipulationControllerRef.current) {\n        boneManipulationControllerRef.current = new BoneManipulationController(\n          vrmRef.current,\n          sceneRef.current,\n          cameraRef.current,\n          rendererRef.current\n        );\n      }\n\n      boneManipulationControllerRef.current.setMode(mode);\n    },\n  }));\n\n  const playAnimation = (clip: THREE.AnimationClip) => {\n    if (!vrmRef.current) return;\n\n    // Create mixer if it doesn't exist\n    if (!mixerRef.current) {\n      mixerRef.current = new THREE.AnimationMixer(vrmRef.current.scene);\n    }\n\n    // Stop current animation if playing\n    if (currentAnimationRef.current) {\n      currentAnimationRef.current.fadeOut(0.3);\n    }\n\n    // Play new animation\n    const action = mixerRef.current.clipAction(clip);\n    action.reset();\n    action.fadeIn(0.3);\n    action.timeScale = 1.0; // Normal speed playback\n    action.play();\n\n    currentAnimationRef.current = action;\n  };\n\n  useEffect(() => {\n    if (!canvasRef.current) return;\n\n    const container = canvasRef.current.parentElement;\n    if (!container) return;\n\n    // Check WebGL support FIRST\n    const testCanvas = document.createElement(\"canvas\");\n    const gl =\n      testCanvas.getContext(\"webgl\") ||\n      (testCanvas.getContext(\n        \"experimental-webgl\"\n      ) as WebGLRenderingContext | null);\n\n    if (!gl) {\n      console.error(\"âŒ WebGL not supported!\");\n      const errorDiv = document.createElement(\"div\");\n      errorDiv.className =\n        \"absolute inset-0 flex items-center justify-center bg-black/50 text-white z-50\";\n      errorDiv.innerHTML =\n        '<div class=\"text-center p-8\"><h2 class=\"text-2xl font-bold text-red-500 mb-4\">WebGL Not Supported</h2><p>Your device does not support WebGL. 3D features will not work.</p></div>';\n      container.appendChild(errorDiv);\n      return;\n    }\n\n    console.log(\"âœ… WebGL supported\");\n    console.log(\"ðŸ“± Device info:\", {\n      userAgent: navigator.userAgent,\n      maxTextureSize: gl.getParameter(gl.MAX_TEXTURE_SIZE),\n      maxRenderbufferSize: gl.getParameter(gl.MAX_RENDERBUFFER_SIZE),\n      isMobile: /iPhone|iPad|iPod|Android/i.test(navigator.userAgent),\n    });\n\n    // Capture blob URLs set for cleanup\n    const blobUrlsToCleanup = activeBlobUrlsRef.current;\n\n    // Get container dimensions\n    const getContainerSize = () => ({\n      width: container.clientWidth,\n      height: container.clientHeight,\n    });\n\n    const { width, height } = getContainerSize();\n\n    // Detect mobile device\n    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);\n\n    // Setup renderer with mobile optimizations\n    const renderer = new THREE.WebGLRenderer({\n      canvas: canvasRef.current,\n      alpha: true,\n      antialias: !isMobile, // Disable antialiasing on mobile for performance\n      powerPreference: \"high-performance\",\n      failIfMajorPerformanceCaveat: false, // Don't fail on slow devices\n    });\n    renderer.setSize(width, height);\n    renderer.setPixelRatio(Math.min(window.devicePixelRatio, isMobile ? 2 : 3)); // Limit pixel ratio on mobile\n    renderer.outputColorSpace = THREE.SRGBColorSpace;\n    rendererRef.current = renderer;\n\n    // Add WebGL context loss/restore handlers\n    const canvas = canvasRef.current;\n\n    const handleContextLost = (event: Event) => {\n      event.preventDefault();\n      console.error(\"âš ï¸ WebGL context lost!\");\n    };\n\n    const handleContextRestored = () => {\n      console.log(\"âœ… WebGL context restored\");\n      // Reinitialize if needed\n    };\n\n    canvas.addEventListener(\n      \"webglcontextlost\",\n      handleContextLost as EventListener\n    );\n    canvas.addEventListener(\n      \"webglcontextrestored\",\n      handleContextRestored as EventListener\n    );\n\n    // Setup camera with mobile-optimized FOV\n    const fov = isMobile ? 45.0 : 30.0; // Wider FOV for mobile\n    const camera = new THREE.PerspectiveCamera(fov, width / height, 0.1, 20.0);\n    camera.position.set(0.0, 1.0, 5.0);\n    cameraRef.current = camera;\n\n    // Setup controls\n    const controls = new OrbitControls(camera, renderer.domElement);\n    controls.screenSpacePanning = true;\n    controls.target.set(0.0, 1.0, 0.0);\n\n    // Enable smooth damping for inertia-like behavior (rotation and zoom)\n    controls.enableDamping = true;\n    controls.dampingFactor = 0.05;\n\n    // Enable smooth zoom\n    controls.enableZoom = true;\n    controls.zoomSpeed = 1.0;\n\n    // Set distance constraints\n    controls.minDistance = 1;\n    controls.maxDistance = 10;\n\n    // Allow full 360-degree rotation (no polar angle limits)\n    // controls.maxPolarAngle = Math.PI / 2; // Removed to allow full rotation\n\n    controls.update();\n    controlsRef.current = controls;\n\n    // Setup scene\n    const scene = new THREE.Scene();\n    sceneRef.current = scene;\n\n    // Add lighting\n    const light = new THREE.DirectionalLight(0xffffff, Math.PI);\n    light.position.set(1.0, 1.0, 1.0).normalize();\n    scene.add(light);\n\n    // Add ambient light for better visibility\n    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);\n    scene.add(ambientLight);\n\n    // Setup loader\n    const loader = new GLTFLoader();\n    loader.register((parser) => {\n      return new VRMLoaderPlugin(parser);\n    });\n    loaderRef.current = loader;\n\n    // Add helpers for development\n    const gridHelper = new THREE.GridHelper(10, 10);\n    gridHelperRef.current = gridHelper;\n    scene.add(gridHelper);\n\n    const axesHelper = new THREE.AxesHelper(5);\n    axesHelperRef.current = axesHelper;\n    scene.add(axesHelper);\n\n    // Animation loop\n    const clock = new THREE.Clock();\n\n    function animate() {\n      requestAnimationFrame(animate);\n      const delta = clock.getDelta();\n\n      if (vrmRef.current) {\n        vrmRef.current.update(delta);\n      }\n\n      // Update bone manipulation controller\n      if (boneManipulationControllerRef.current) {\n        boneManipulationControllerRef.current.update();\n      }\n\n      // Update animation mixer\n      if (mixerRef.current) {\n        mixerRef.current.update(delta);\n      }\n\n      // Follow character if enabled (tracks hips bone position)\n      if (cameraFollowCharacterRef.current && vrmRef.current) {\n        // Find hips bone (common VRM bone name)\n        const hips = vrmRef.current.humanoid?.getNormalizedBoneNode(\"hips\");\n        if (hips) {\n          // Get world position of hips\n          const hipsPosition = new THREE.Vector3();\n          hips.getWorldPosition(hipsPosition);\n          // Apply user-defined offset\n          const targetPosition = hipsPosition\n            .clone()\n            .add(cameraFollowOffsetRef.current);\n          // Update camera target to follow hips with offset\n          controls.target.copy(targetPosition);\n        }\n      }\n\n      controls.update();\n\n      renderer.render(scene, camera);\n    }\n    animate();\n\n    // Handle window resize\n    const handleResize = () => {\n      const { width, height } = getContainerSize();\n      camera.aspect = width / height;\n      camera.updateProjectionMatrix();\n      renderer.setSize(width, height);\n    };\n    window.addEventListener(\"resize\", handleResize);\n\n    // Mouse event handlers for camera follow offset adjustment\n    const handleMouseDown = (event: MouseEvent) => {\n      if (event.button === 2 && cameraFollowCharacterRef.current) {\n        // Right mouse button\n        isRightMouseDownRef.current = true;\n        lastMousePositionRef.current = { x: event.clientX, y: event.clientY };\n        event.preventDefault();\n      }\n    };\n\n    const handleMouseMove = (event: MouseEvent) => {\n      if (isRightMouseDownRef.current && cameraFollowCharacterRef.current) {\n        const deltaX = event.clientX - lastMousePositionRef.current.x;\n        const deltaY = event.clientY - lastMousePositionRef.current.y;\n\n        // Adjust offset based on mouse movement\n        // Scale factor for sensitivity (adjust as needed)\n        const sensitivity = 0.005;\n        cameraFollowOffsetRef.current.x += deltaX * sensitivity;\n        cameraFollowOffsetRef.current.y -= deltaY * sensitivity; // Inverted Y for intuitive control\n\n        lastMousePositionRef.current = { x: event.clientX, y: event.clientY };\n        event.preventDefault();\n      }\n    };\n\n    const handleMouseUp = (event: MouseEvent) => {\n      if (event.button === 2) {\n        isRightMouseDownRef.current = false;\n      }\n    };\n\n    const handleContextMenu = (event: MouseEvent) => {\n      if (cameraFollowCharacterRef.current) {\n        event.preventDefault(); // Prevent context menu when camera follow is active\n      }\n    };\n\n    const handleTransformDragging = (event: Event) => {\n      const customEvent = event as CustomEvent<boolean>;\n      if (controlsRef.current) {\n        controlsRef.current.enabled = !customEvent.detail;\n      }\n    };\n\n    canvas.addEventListener(\"mousedown\", handleMouseDown);\n    canvas.addEventListener(\"mousemove\", handleMouseMove);\n    canvas.addEventListener(\"mouseup\", handleMouseUp);\n    canvas.addEventListener(\"contextmenu\", handleContextMenu);\n    canvas.addEventListener(\n      \"transform-dragging\",\n      handleTransformDragging as EventListener\n    );\n\n    // Cleanup\n    return () => {\n      window.removeEventListener(\"resize\", handleResize);\n      canvas.removeEventListener(\"mousedown\", handleMouseDown);\n      canvas.removeEventListener(\"mousemove\", handleMouseMove);\n      canvas.removeEventListener(\"mouseup\", handleMouseUp);\n      canvas.removeEventListener(\"contextmenu\", handleContextMenu);\n      canvas.removeEventListener(\n        \"transform-dragging\",\n        handleTransformDragging as EventListener\n      );\n      canvas.removeEventListener(\"mousemove\", handleMouseMove);\n      canvas.removeEventListener(\"mouseup\", handleMouseUp);\n      canvas.removeEventListener(\"contextmenu\", handleContextMenu);\n      canvas.removeEventListener(\n        \"webglcontextlost\",\n        handleContextLost as EventListener\n      );\n      canvas.removeEventListener(\n        \"webglcontextrestored\",\n        handleContextRestored as EventListener\n      );\n      renderer.dispose();\n      controls.dispose();\n      scene.clear();\n\n      // Cleanup bone manipulation controller\n      if (boneManipulationControllerRef.current) {\n        boneManipulationControllerRef.current.dispose();\n        boneManipulationControllerRef.current = null;\n      }\n\n      // Revoke all blob URLs on unmount\n      blobUrlsToCleanup.forEach((blobUrl) => {\n        URL.revokeObjectURL(blobUrl);\n      });\n      blobUrlsToCleanup.clear();\n    };\n  }, []);\n\n  return (\n    <canvas\n      ref={canvasRef}\n      id=\"canvas\"\n      className=\"w-full h-full\"\n      style={{ display: \"block\" }}\n    />\n  );\n});\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1463, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/ui/accordion.tsx"],"sourcesContent":["import * as React from \"react\";\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\";\nimport { ChevronDown } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst Accordion = AccordionPrimitive.Root;\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n));\nAccordionItem.displayName = \"AccordionItem\";\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n));\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName;\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n));\nAccordionContent.displayName = AccordionPrimitive.Content.displayName;\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent };\n"],"names":[],"mappings":";;;;;;;;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,YAAY,6KAAuB;AAEzC,MAAM,8BAAgB,mNAAgB,CAGpC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,6KAAuB;QACtB,KAAK;QACL,WAAW,IAAA,kHAAE,EAAC,YAAY;QACzB,GAAG,KAAK;;;;;;AAGb,cAAc,WAAW,GAAG;AAE5B,MAAM,iCAAmB,mNAAgB,CAGvC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpC,8OAAC,+KAAyB;QAAC,WAAU;kBACnC,cAAA,8OAAC,gLAA0B;YACzB,KAAK;YACL,WAAW,IAAA,kHAAE,EACX,kJACA;YAED,GAAG,KAAK;;gBAER;8BACD,8OAAC,mOAAW;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAI7B,iBAAiB,WAAW,GAAG,gLAA0B,CAAC,WAAW;AAErE,MAAM,iCAAmB,mNAAgB,CAGvC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpC,8OAAC,gLAA0B;QACzB,KAAK;QACL,WAAU;QACT,GAAG,KAAK;kBAET,cAAA,8OAAC;YAAI,WAAW,IAAA,kHAAE,EAAC,aAAa;sBAAa;;;;;;;;;;;AAGjD,iBAAiB,WAAW,GAAG,gLAA0B,CAAC,WAAW"}},
    {"offset": {"line": 1544, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/ui/slider.tsx"],"sourcesContent":["import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,uBAAS,mNAAgB,CAG7B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,0KAAoB;QACnB,KAAK;QACL,WAAW,IAAA,kHAAE,EACX,4DACA;QAED,GAAG,KAAK;;0BAET,8OAAC,2KAAqB;gBAAC,WAAU;0BAC/B,cAAA,8OAAC,2KAAqB;oBAAC,WAAU;;;;;;;;;;;0BAEnC,8OAAC,2KAAqB;gBAAC,WAAU;;;;;;;;;;;;AAGrC,OAAO,WAAW,GAAG,0KAAoB,CAAC,WAAW"}},
    {"offset": {"line": 1594, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/ui/tabs.tsx"],"sourcesContent":["import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n"],"names":[],"mappings":";;;;;;;;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,OAAO,wKAAkB;AAE/B,MAAM,yBAAW,mNAAgB,CAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,wKAAkB;QACjB,KAAK;QACL,WAAW,IAAA,kHAAE,EACX,6FACA;QAED,GAAG,KAAK;;;;;;AAGb,SAAS,WAAW,GAAG,wKAAkB,CAAC,WAAW;AAErD,MAAM,4BAAc,mNAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,2KAAqB;QACpB,KAAK;QACL,WAAW,IAAA,kHAAE,EACX,kYACA;QAED,GAAG,KAAK;;;;;;AAGb,YAAY,WAAW,GAAG,2KAAqB,CAAC,WAAW;AAE3D,MAAM,4BAAc,mNAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,2KAAqB;QACpB,KAAK;QACL,WAAW,IAAA,kHAAE,EACX,mIACA;QAED,GAAG,KAAK;;;;;;AAGb,YAAY,WAAW,GAAG,2KAAqB,CAAC,WAAW"}},
    {"offset": {"line": 1648, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/constants/index.tsx"],"sourcesContent":["export const predefinedAvatars = [\n  {\n    name: \"Hatsune Miku\",\n    path: \"/models/vrm/HatsuneMikuNT.vrm\",\n    thumbnail: \"/images/hatsune-icon.png\",\n  },\n  {\n    name: \"Evernight\",\n    path: \"/models/vrm/Evernight.vrm\",\n    thumbnail: \"/images/evernight-icon.png\",\n  },\n  {\n    name: \"Larasdyah\",\n    path: \"/models/glb/Larasdyah_Character2.glb\",\n    thumbnail: \"/images/larasdyah-icon.png\",\n  },\n  {\n    name: \"Carlotta\",\n    path: \"/models/vrm/carlotta_wuwa.vrm\",\n    thumbnail: \"/images/carlotta-icon.png\",\n  },\n  {\n    name: \"Phoebe\",\n    path: \"/models/vrm/phoebe_wuwa.vrm\",\n    thumbnail: \"/images/phoebe-icon.png\",\n  },\n  {\n    name: \"Zani\",\n    path: \"/models/vrm/zani_wuwa.vrm\",\n    thumbnail: \"/images/zani-icon.png\",\n  },\n  {\n    name: \"Firefly\",\n    path: \"/models/vrm/firefly_hsr.vrm\",\n    thumbnail: \"/images/firefly-icon.png\",\n  },\n  {\n    name: \"Orpheus\",\n    path: \"/models/vrm/orpheus_zzz.vrm\",\n    thumbnail: \"/images/orpheus-icon.png\",\n  },\n];\n\nexport const predefinedAnimations = [\n  {\n    name: \"Breathing Idle\",\n    path: \"/models/animations/Breathing_Idle.fbx\",\n    thumbnail: \"/images/default-thumbnail-3davatar.png\",\n  },\n  {\n    name: \"Standing Idle\",\n    path: \"/models/animations/Standing_Idle.fbx\",\n    thumbnail: \"/images/default-thumbnail-3davatar.png\",\n  },\n  {\n    name: \"Swing Dancing\",\n    path: \"/models/animations/Swing_Dancing.fbx\",\n    thumbnail: \"/images/default-thumbnail-3davatar.png\",\n  },\n  {\n    name: \"Thriller Dance\",\n    path: \"/models/animations/Thriller_Part_2.fbx\",\n    thumbnail: \"/images/default-thumbnail-3davatar.png\",\n  },\n  {\n    name: \"Talking\",\n    path: \"/models/animations/Talking.fbx\",\n    thumbnail: \"/images/default-thumbnail-3davatar.png\",\n  },\n  {\n    name: \"Walking\",\n    path: \"/models/animations/Walking.fbx\",\n    thumbnail: \"/images/default-thumbnail-3davatar.png\",\n  },\n  {\n    name: \"Angry\",\n    path: \"/models/animations/Angry.fbx\",\n    thumbnail: \"/images/default-thumbnail-3davatar.png\",\n  },\n  {\n    name: \"Rumba Dance\",\n    path: \"/models/animations/Rumba_Dancing.fbx\",\n    thumbnail: \"/images/default-thumbnail-3davatar.png\",\n  },\n  {\n    name: \"Explaining\",\n    path: \"/models/animations/Explaining.fbx\",\n    thumbnail: \"/images/default-thumbnail-3davatar.png\",\n  },\n];\n\nexport const predefinedPoses = [\n  {\n    name: \"T-shape\",\n    path: \"/models/poses/T-shape.json\",\n    thumbnail: \"/images/default-thumbnail-3davatar.png\",\n  },\n  {\n    name: \"A-shape\",\n    path: \"/models/poses/A-shape.json\",\n    thumbnail: \"/images/default-thumbnail-3davatar.png\",\n  },\n  {\n    name: \"Standing\",\n    path: \"/models/poses/Standing.json\",\n    thumbnail: \"/images/default-thumbnail-3davatar.png\",\n  },\n  {\n    name: \"Double Peace\",\n    path: \"/models/poses/Double Peace.json\",\n    thumbnail: \"/images/default-thumbnail-3davatar.png\",\n  },\n];\n"],"names":[],"mappings":";;;;;;;;AAAO,MAAM,oBAAoB;IAC/B;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;CACD;AAEM,MAAM,uBAAuB;IAClC;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;CACD;AAEM,MAAM,kBAAkB;IAC7B;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA;QACE,MAAM;QACN,MAAM;QACN,WAAW;IACb;CACD"}},
    {"offset": {"line": 1771, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/VRMDatGUIControl.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useRef } from \"react\";\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { predefinedPoses, predefinedAnimations } from \"@/constants\";\nimport { Trash2, Download, Upload } from \"lucide-react\";\n\ninterface PoseData {\n  name?: string;\n  code?: string;\n  vrmVersion?: string;\n  data?: Record<string, unknown>;\n}\n\ninterface SpringBoneSettings {\n  dragForce: number;\n  gravityPower: number;\n  hitRadius: number;\n  stiffness: number;\n  gravityDir: {\n    x: number;\n    y: number;\n    z: number;\n  };\n}\n\ninterface SpringBone {\n  name: string;\n  settings: SpringBoneSettings;\n}\n\ninterface Expression {\n  name: string;\n  value: number;\n}\n\ninterface ShapeKey {\n  name: string;\n  value: number;\n}\n\ninterface CustomPose {\n  name: string;\n  data: PoseData;\n}\n\ninterface Animation {\n  name: string;\n  url: string;\n}\n\nexport interface VRMDatGUIControlRef {\n  getExpressions: () => Expression[];\n  getShapeKeys: () => ShapeKey[];\n  getSpringBones: () => SpringBone[];\n}\n\ninterface VRMDatGUIControlProps {\n  onPoseLoad?: (poseData: PoseData) => void;\n  onBoneManipulationModeChange?: (mode: \"off\" | \"ik\" | \"fk\") => void;\n  onExpressionChange?: (name: string, value: number) => void;\n  onShapeKeyChange?: (name: string, value: number) => void;\n  onSpringBoneSettingChange?: (\n    boneName: string,\n    setting: keyof SpringBoneSettings,\n    value: number\n  ) => void;\n  onSavePose?: (poseName: string, poseData: PoseData) => void;\n  onAnimationPlay?: (animationUrl: string) => void;\n  onAnimationSpeedChange?: (speed: number) => void;\n  expressions?: Expression[];\n  shapeKeys?: ShapeKey[];\n  springBones?: SpringBone[];\n  animationSpeed?: number;\n}\n\nexport const VRMDatGUIControl = ({\n  onPoseLoad,\n  onBoneManipulationModeChange,\n  onExpressionChange,\n  onShapeKeyChange,\n  onSpringBoneSettingChange,\n  onSavePose,\n  onAnimationPlay,\n  onAnimationSpeedChange,\n  expressions = [],\n  shapeKeys = [],\n  springBones = [],\n  animationSpeed = 0.5,\n}: VRMDatGUIControlProps) => {\n  const [showControls, setShowControls] = useState(false);\n  const [customPoses, setCustomPoses] = useState<CustomPose[]>([]);\n  const [boneMode, setBoneMode] = useState<\"off\" | \"ik\" | \"fk\">(\"off\");\n  const [newPoseName, setNewPoseName] = useState(\"\");\n  const [showAddPose, setShowAddPose] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const animationFileInputRef = useRef<HTMLInputElement>(null);\n  const [customAnimations, setCustomAnimations] = useState<Animation[]>([]);\n  const [animationSpeedInput, setAnimationSpeedInput] = useState(\n    animationSpeed.toString()\n  );\n\n  // Expression input states\n  const [expressionInputs, setExpressionInputs] = useState<\n    Record<string, string>\n  >({});\n\n  // ShapeKey input states\n  const [shapeKeyInputs, setShapeKeyInputs] = useState<Record<string, string>>(\n    {}\n  );\n\n  // Spring bone input states\n  const [springBoneInputs, setSpringBoneInputs] = useState<\n    Record<string, Record<string, string>>\n  >({});\n\n  // Initialize input states when data changes\n  useEffect(() => {\n    const newInputs: Record<string, string> = {};\n    expressions.forEach((exp) => {\n      newInputs[exp.name] = exp.value.toString();\n    });\n    setExpressionInputs(newInputs);\n  }, [expressions]);\n\n  useEffect(() => {\n    const newInputs: Record<string, string> = {};\n    shapeKeys.forEach((key) => {\n      newInputs[key.name] = key.value.toString();\n    });\n    setShapeKeyInputs(newInputs);\n  }, [shapeKeys]);\n\n  useEffect(() => {\n    const newInputs: Record<string, Record<string, string>> = {};\n    springBones.forEach((bone) => {\n      newInputs[bone.name] = {\n        dragForce: bone.settings.dragForce.toString(),\n        gravityPower: bone.settings.gravityPower.toString(),\n        hitRadius: bone.settings.hitRadius.toString(),\n        stiffness: bone.settings.stiffness.toString(),\n        gravityDirX: bone.settings.gravityDir.x.toString(),\n        gravityDirY: bone.settings.gravityDir.y.toString(),\n        gravityDirZ: bone.settings.gravityDir.z.toString(),\n      };\n    });\n    setSpringBoneInputs(newInputs);\n  }, [springBones]);\n\n  useEffect(() => {\n    setAnimationSpeedInput(animationSpeed.toString());\n  }, [animationSpeed]);\n\n  const handlePoseClick = async (posePath: string) => {\n    try {\n      const response = await fetch(posePath);\n      const poseData = await response.json();\n      onPoseLoad?.(poseData);\n    } catch (error) {\n      console.error(\"Failed to load pose:\", error);\n    }\n  };\n\n  const handleCustomPoseClick = (poseData: PoseData) => {\n    onPoseLoad?.(poseData);\n  };\n\n  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file && file.name.endsWith(\".json\")) {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        try {\n          const poseData = JSON.parse(e.target?.result as string);\n          const poseName = file.name.replace(\".json\", \"\");\n          setCustomPoses([...customPoses, { name: poseName, data: poseData }]);\n          onPoseLoad?.(poseData);\n        } catch (error) {\n          console.error(\"Failed to parse pose file:\", error);\n        }\n      };\n      reader.readAsText(file);\n    }\n    // Reset input\n    if (fileInputRef.current) {\n      fileInputRef.current.value = \"\";\n    }\n  };\n\n  const handleSaveCurrentPose = () => {\n    if (newPoseName.trim()) {\n      // This would need to get current bone positions from VRM\n      // For now, we'll just signal the parent to save\n      onSavePose?.(newPoseName, {});\n      setNewPoseName(\"\");\n      setShowAddPose(false);\n    }\n  };\n\n  const handleDeleteCustomPose = (index: number) => {\n    setCustomPoses(customPoses.filter((_, i) => i !== index));\n  };\n\n  const handleDownloadPose = (pose: CustomPose) => {\n    const dataStr = JSON.stringify(pose.data, null, 2);\n    const dataUri =\n      \"data:application/json;charset=utf-8,\" + encodeURIComponent(dataStr);\n    const exportFileDefaultName = `${pose.name}.json`;\n\n    const linkElement = document.createElement(\"a\");\n    linkElement.setAttribute(\"href\", dataUri);\n    linkElement.setAttribute(\"download\", exportFileDefaultName);\n    linkElement.click();\n  };\n\n  const handleBoneModeChange = (mode: string) => {\n    const newMode = mode as \"off\" | \"ik\" | \"fk\";\n    setBoneMode(newMode);\n    onBoneManipulationModeChange?.(newMode);\n  };\n\n  const handleExpressionInputChange = (name: string, value: string) => {\n    setExpressionInputs({ ...expressionInputs, [name]: value });\n  };\n\n  const handleExpressionInputBlur = (name: string, currentValue: number) => {\n    const value = parseFloat(expressionInputs[name]?.replace(\",\", \".\") || \"0\");\n    if (!isNaN(value)) {\n      const clamped = Math.max(0, Math.min(1, value));\n      onExpressionChange?.(name, clamped);\n    } else {\n      setExpressionInputs({\n        ...expressionInputs,\n        [name]: currentValue.toString(),\n      });\n    }\n  };\n\n  const handleShapeKeyInputChange = (name: string, value: string) => {\n    setShapeKeyInputs({ ...shapeKeyInputs, [name]: value });\n  };\n\n  const handleShapeKeyInputBlur = (name: string, currentValue: number) => {\n    const value = parseFloat(shapeKeyInputs[name]?.replace(\",\", \".\") || \"0\");\n    if (!isNaN(value)) {\n      const clamped = Math.max(0, Math.min(1, value));\n      onShapeKeyChange?.(name, clamped);\n    } else {\n      setShapeKeyInputs({ ...shapeKeyInputs, [name]: currentValue.toString() });\n    }\n  };\n\n  const handleAnimationFileUpload = (\n    event: React.ChangeEvent<HTMLInputElement>\n  ) => {\n    const file = event.target.files?.[0];\n    if (file && (file.name.endsWith(\".fbx\") || file.name.endsWith(\".glb\"))) {\n      const url = URL.createObjectURL(file);\n      const animationName = file.name.replace(/\\.(fbx|glb)$/, \"\");\n      setCustomAnimations([...customAnimations, { name: animationName, url }]);\n    }\n    // Reset input\n    if (animationFileInputRef.current) {\n      animationFileInputRef.current.value = \"\";\n    }\n  };\n\n  const handleAnimationPlay = (animationUrl: string) => {\n    onAnimationPlay?.(animationUrl);\n  };\n\n  const handleAnimationSpeedInputChange = (value: string) => {\n    setAnimationSpeedInput(value);\n  };\n\n  const handleAnimationSpeedInputBlur = () => {\n    const value = parseFloat(animationSpeedInput.replace(\",\", \".\") || \"1\");\n    if (!isNaN(value)) {\n      const clamped = Math.max(0, Math.min(2, value));\n      onAnimationSpeedChange?.(clamped);\n    } else {\n      setAnimationSpeedInput(animationSpeed.toString());\n    }\n  };\n\n  const handleDeleteCustomAnimation = (index: number) => {\n    const animation = customAnimations[index];\n    URL.revokeObjectURL(animation.url);\n    setCustomAnimations(customAnimations.filter((_, i) => i !== index));\n  };\n\n  return (\n    <>\n      {showControls ? (\n        <div className=\"absolute top-20 right-4 w-[200px] md:w-[280px] lg:w-[320px] max-h-[calc(100%-100px)] overflow-y-auto bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/90 border rounded-lg shadow-lg z-[45]\">\n          <Accordion type=\"multiple\" defaultValue={[]} className=\"w-full\">\n            {/* Animations Controls */}\n            <AccordionItem value=\"animations\">\n              <AccordionTrigger className=\"px-4 py-3 text-base font-semibold\">\n                Animations\n              </AccordionTrigger>\n              <AccordionContent className=\"px-4 pb-4 space-y-4\">\n                {/* Upload/Drop Zone */}\n                <div className=\"border-2 border-dashed rounded-lg p-4 text-center\">\n                  <input\n                    ref={animationFileInputRef}\n                    type=\"file\"\n                    accept=\".fbx,.glb\"\n                    onChange={handleAnimationFileUpload}\n                    className=\"hidden\"\n                  />\n                  <Upload className=\"mx-auto h-8 w-8 text-muted-foreground mb-2\" />\n                  <p className=\"text-sm text-muted-foreground mb-2\">\n                    Upload or drop <span className=\"text-primary\">fbx,glb</span>{\" \"}\n                    file here\n                  </p>\n                  <Button\n                    onClick={() => animationFileInputRef.current?.click()}\n                    variant=\"outline\"\n                    size=\"sm\"\n                  >\n                    Choose File\n                  </Button>\n                </div>\n\n                {/* Animation Speed Control */}\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-semibold\">\n                    Animation Speed\n                  </Label>\n                  <div className=\"space-y-1\">\n                    <div className=\"flex items-center justify-between\">\n                      <Label className=\"text-xs\">Speed</Label>\n                      <Input\n                        type=\"text\"\n                        inputMode=\"decimal\"\n                        value={animationSpeedInput}\n                        onChange={(e) =>\n                          handleAnimationSpeedInputChange(e.target.value)\n                        }\n                        onBlur={handleAnimationSpeedInputBlur}\n                        onKeyDown={(e) => {\n                          if (e.key === \"Enter\") {\n                            e.currentTarget.blur();\n                          }\n                        }}\n                        className=\"w-16 h-7 text-xs\"\n                      />\n                    </div>\n                    <Slider\n                      min={0}\n                      max={2}\n                      step={0.01}\n                      value={[animationSpeed]}\n                      onValueChange={([value]) =>\n                        onAnimationSpeedChange?.(value)\n                      }\n                    />\n                  </div>\n                </div>\n\n                {/* Available Animations */}\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-semibold\">\n                    Available animations\n                  </Label>\n\n                  <div\n                    className={\n                      predefinedAnimations.length + customAnimations.length > 10\n                        ? \"grid grid-cols-2 gap-2 max-h-[300px] overflow-y-auto p-2 bg-secondary/30 rounded-lg\"\n                        : \"grid grid-cols-2 gap-2\"\n                    }\n                  >\n                    {/* Predefined Animations */}\n                    {predefinedAnimations.map((animation) => (\n                      <Button\n                        key={animation.path}\n                        onClick={() => handleAnimationPlay(animation.path)}\n                        variant=\"default\"\n                        className=\"h-auto py-3 px-2 text-xs md:text-xs text-[10px] font-medium leading-tight\"\n                        size=\"sm\"\n                      >\n                        {animation.name}\n                      </Button>\n                    ))}\n\n                    {/* Custom Animations */}\n                    {customAnimations.map((animation, index) => (\n                      <div key={`custom-${index}`} className=\"relative group\">\n                        <Button\n                          onClick={() => handleAnimationPlay(animation.url)}\n                          variant=\"secondary\"\n                          className=\"w-full h-auto py-3 px-2 text-xs md:text-xs text-[10px] font-medium leading-tight\"\n                          size=\"sm\"\n                        >\n                          {animation.name}\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleDeleteCustomAnimation(index)}\n                          className=\"absolute -top-1 -right-1 h-5 w-5 p-0 opacity-0 group-hover:opacity-100 transition-opacity bg-destructive hover:bg-destructive/90 text-destructive-foreground rounded-full\"\n                        >\n                          <Trash2 className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </AccordionContent>\n            </AccordionItem>\n\n            {/* Posing Controls */}\n            <AccordionItem value=\"posing\">\n              <AccordionTrigger className=\"px-4 py-3 text-base font-semibold\">\n                Posing\n              </AccordionTrigger>\n              <AccordionContent className=\"px-4 pb-4 space-y-4\">\n                {/* Upload/Drop Zone */}\n                <div className=\"border-2 border-dashed rounded-lg p-4 text-center\">\n                  <input\n                    ref={fileInputRef}\n                    type=\"file\"\n                    accept=\".json\"\n                    onChange={handleFileUpload}\n                    className=\"hidden\"\n                  />\n                  <Upload className=\"mx-auto h-8 w-8 text-muted-foreground mb-2\" />\n                  <p className=\"text-sm text-muted-foreground mb-2\">\n                    Upload or drop json file here\n                  </p>\n                  <Button\n                    onClick={() => fileInputRef.current?.click()}\n                    variant=\"outline\"\n                    size=\"sm\"\n                  >\n                    Choose File\n                  </Button>\n                </div>\n\n                {/* Available Poses */}\n                <div className=\"space-y-2\">\n                  <Label className=\"text-sm font-semibold\">\n                    Available poses\n                  </Label>\n\n                  {/* Predefined Poses */}\n                  {predefinedPoses.map((pose) => (\n                    <div\n                      key={pose.path}\n                      className=\"flex items-center justify-between p-2 bg-primary text-primary-foreground rounded hover:bg-primary/90\"\n                    >\n                      <span\n                        className=\"text-sm flex-1 cursor-pointer\"\n                        onClick={() => handlePoseClick(pose.path)}\n                      >\n                        {pose.name}\n                      </span>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={async (e) => {\n                          e.stopPropagation();\n                          try {\n                            const response = await fetch(pose.path);\n                            const poseData = await response.json();\n                            handleDownloadPose({\n                              name: pose.name,\n                              data: poseData,\n                            });\n                          } catch (error) {\n                            console.error(\"Failed to download pose:\", error);\n                          }\n                        }}\n                        className=\"h-auto p-1 hover:bg-primary-foreground/20\"\n                      >\n                        <Download className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  ))}\n\n                  {/* Custom Poses */}\n                  {customPoses.map((pose, index) => (\n                    <div\n                      key={`custom-${index}`}\n                      className=\"flex items-center justify-between p-2 bg-secondary rounded\"\n                    >\n                      <span\n                        className=\"text-sm flex-1 cursor-pointer\"\n                        onClick={() => handleCustomPoseClick(pose.data)}\n                      >\n                        {pose.name}\n                      </span>\n                      <div className=\"flex gap-2\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleDownloadPose(pose)}\n                        >\n                          <Download className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleDeleteCustomPose(index)}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n\n                {/* Add Pose */}\n                {!showAddPose ? (\n                  <Button\n                    onClick={() => setShowAddPose(true)}\n                    variant=\"outline\"\n                    className=\"w-full\"\n                  >\n                    + Add Custom Pose\n                  </Button>\n                ) : (\n                  <div className=\"space-y-2 p-3 border rounded-lg\">\n                    <Input\n                      placeholder=\"Pose name\"\n                      value={newPoseName}\n                      onChange={(e) => setNewPoseName(e.target.value)}\n                    />\n                    <div className=\"flex gap-2\">\n                      <Button\n                        onClick={handleSaveCurrentPose}\n                        size=\"sm\"\n                        disabled={!newPoseName.trim()}\n                        className=\"flex-1\"\n                      >\n                        ADD\n                      </Button>\n                      <Button\n                        onClick={() => {\n                          setShowAddPose(false);\n                          setNewPoseName(\"\");\n                        }}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"flex-1\"\n                      >\n                        DISCARD\n                      </Button>\n                    </div>\n\n                    {/* Bone Manipulation Mode */}\n                    <Tabs\n                      value={boneMode}\n                      onValueChange={handleBoneModeChange}\n                      className=\"w-full\"\n                    >\n                      <TabsList className=\"grid w-full grid-cols-3\">\n                        <TabsTrigger value=\"off\">OFF</TabsTrigger>\n                        <TabsTrigger value=\"ik\">IK</TabsTrigger>\n                        <TabsTrigger value=\"fk\">FK</TabsTrigger>\n                      </TabsList>\n                    </Tabs>\n                  </div>\n                )}\n              </AccordionContent>\n            </AccordionItem>\n\n            {/* Spring Bones Controls */}\n            <AccordionItem value=\"springBones\">\n              <AccordionTrigger className=\"px-4 py-3 text-base font-semibold\">\n                Spring bones\n              </AccordionTrigger>\n              <AccordionContent className=\"px-4 pb-4\">\n                {springBones.length === 0 ? (\n                  <p className=\"text-sm text-muted-foreground\">\n                    No spring bones available\n                  </p>\n                ) : (\n                  <div\n                    className={\n                      springBones.length > 10\n                        ? \"bg-secondary/50 rounded-lg p-3 max-h-[400px] overflow-y-auto\"\n                        : \"\"\n                    }\n                  >\n                    <Accordion\n                      type=\"single\"\n                      collapsible\n                      className=\"w-full pl-2\"\n                    >\n                      {springBones.map((bone) => (\n                        <AccordionItem key={bone.name} value={bone.name}>\n                          <AccordionTrigger className=\"text-sm py-2\">\n                            {bone.name}\n                          </AccordionTrigger>\n                          <AccordionContent className=\"space-y-3 pb-2\">\n                            {/* Drag Force */}\n                            <div className=\"space-y-1\">\n                              <div className=\"flex items-center justify-between\">\n                                <Label className=\"text-xs\">DragForce</Label>\n                                <Input\n                                  type=\"text\"\n                                  inputMode=\"decimal\"\n                                  value={\n                                    springBoneInputs[bone.name]?.dragForce ||\n                                    \"0\"\n                                  }\n                                  onChange={(e) => {\n                                    const newInputs = { ...springBoneInputs };\n                                    if (!newInputs[bone.name])\n                                      newInputs[bone.name] = {\n                                        dragForce: \"\",\n                                        gravityPower: \"\",\n                                        hitRadius: \"\",\n                                        stiffness: \"\",\n                                        gravityDirX: \"\",\n                                        gravityDirY: \"\",\n                                        gravityDirZ: \"\",\n                                      };\n                                    newInputs[bone.name].dragForce =\n                                      e.target.value;\n                                    setSpringBoneInputs(newInputs);\n                                  }}\n                                  onBlur={() => {\n                                    const value = parseFloat(\n                                      springBoneInputs[\n                                        bone.name\n                                      ]?.dragForce?.replace(\",\", \".\") || \"0\"\n                                    );\n                                    if (!isNaN(value)) {\n                                      onSpringBoneSettingChange?.(\n                                        bone.name,\n                                        \"dragForce\",\n                                        value\n                                      );\n                                    }\n                                  }}\n                                  className=\"w-16 h-7 text-xs\"\n                                />\n                              </div>\n                            </div>\n\n                            {/* Gravity Power */}\n                            <div className=\"space-y-1\">\n                              <div className=\"flex items-center justify-between\">\n                                <Label className=\"text-xs\">GravityPower</Label>\n                                <Input\n                                  type=\"text\"\n                                  inputMode=\"decimal\"\n                                  value={\n                                    springBoneInputs[bone.name]?.gravityPower ||\n                                    \"0\"\n                                  }\n                                  onChange={(e) => {\n                                    const newInputs = { ...springBoneInputs };\n                                    if (!newInputs[bone.name])\n                                      newInputs[bone.name] = {\n                                        dragForce: \"\",\n                                        gravityPower: \"\",\n                                        hitRadius: \"\",\n                                        stiffness: \"\",\n                                        gravityDirX: \"\",\n                                        gravityDirY: \"\",\n                                        gravityDirZ: \"\",\n                                      };\n                                    newInputs[bone.name].gravityPower =\n                                      e.target.value;\n                                    setSpringBoneInputs(newInputs);\n                                  }}\n                                  onBlur={() => {\n                                    const value = parseFloat(\n                                      springBoneInputs[\n                                        bone.name\n                                      ]?.gravityPower?.replace(\",\", \".\") || \"0\"\n                                    );\n                                    if (!isNaN(value)) {\n                                      onSpringBoneSettingChange?.(\n                                        bone.name,\n                                        \"gravityPower\",\n                                        value\n                                      );\n                                    }\n                                  }}\n                                  className=\"w-16 h-7 text-xs\"\n                                />\n                              </div>\n                            </div>\n\n                            {/* Hit Radius */}\n                            <div className=\"space-y-1\">\n                              <div className=\"flex items-center justify-between\">\n                                <Label className=\"text-xs\">Hit Radius</Label>\n                                <Input\n                                  type=\"text\"\n                                  inputMode=\"decimal\"\n                                  value={\n                                    springBoneInputs[bone.name]?.hitRadius ||\n                                    \"0\"\n                                  }\n                                  onChange={(e) => {\n                                    const newInputs = { ...springBoneInputs };\n                                    if (!newInputs[bone.name])\n                                      newInputs[bone.name] = {\n                                        dragForce: \"\",\n                                        gravityPower: \"\",\n                                        hitRadius: \"\",\n                                        stiffness: \"\",\n                                        gravityDirX: \"\",\n                                        gravityDirY: \"\",\n                                        gravityDirZ: \"\",\n                                      };\n                                    newInputs[bone.name].hitRadius =\n                                      e.target.value;\n                                    setSpringBoneInputs(newInputs);\n                                  }}\n                                  onBlur={() => {\n                                    const value = parseFloat(\n                                      springBoneInputs[\n                                        bone.name\n                                      ]?.hitRadius?.replace(\",\", \".\") || \"0\"\n                                    );\n                                    if (!isNaN(value)) {\n                                      onSpringBoneSettingChange?.(\n                                        bone.name,\n                                        \"hitRadius\",\n                                        value\n                                      );\n                                    }\n                                  }}\n                                  className=\"w-16 h-7 text-xs\"\n                                />\n                              </div>\n                            </div>\n\n                            {/* Stiffness */}\n                            <div className=\"space-y-1\">\n                              <div className=\"flex items-center justify-between\">\n                                <Label className=\"text-xs\">Stiffness</Label>\n                                <Input\n                                  type=\"text\"\n                                  inputMode=\"decimal\"\n                                  value={\n                                    springBoneInputs[bone.name]?.stiffness ||\n                                    \"0\"\n                                  }\n                                  onChange={(e) => {\n                                    const newInputs = { ...springBoneInputs };\n                                    if (!newInputs[bone.name])\n                                      newInputs[bone.name] = {\n                                        dragForce: \"\",\n                                        gravityPower: \"\",\n                                        hitRadius: \"\",\n                                        stiffness: \"\",\n                                        gravityDirX: \"\",\n                                        gravityDirY: \"\",\n                                        gravityDirZ: \"\",\n                                      };\n                                    newInputs[bone.name].stiffness =\n                                      e.target.value;\n                                    setSpringBoneInputs(newInputs);\n                                  }}\n                                  onBlur={() => {\n                                    const value = parseFloat(\n                                      springBoneInputs[\n                                        bone.name\n                                      ]?.stiffness?.replace(\",\", \".\") || \"0\"\n                                    );\n                                    if (!isNaN(value)) {\n                                      onSpringBoneSettingChange?.(\n                                        bone.name,\n                                        \"stiffness\",\n                                        value\n                                      );\n                                    }\n                                  }}\n                                  className=\"w-16 h-7 text-xs\"\n                                />\n                              </div>\n                            </div>\n\n                            {/* Gravity Dir */}\n                            <div className=\"space-y-2\">\n                              <Label className=\"text-xs font-semibold\">\n                                Gravity Dir\n                              </Label>\n                              <div className=\"grid grid-cols-3 gap-2\">\n                                <div>\n                                  <Label className=\"text-xs text-muted-foreground\">\n                                    X\n                                  </Label>\n                                  <Input\n                                    type=\"text\"\n                                    inputMode=\"decimal\"\n                                    value={\n                                      springBoneInputs[bone.name]\n                                        ?.gravityDirX || \"0\"\n                                    }\n                                    onChange={(e) => {\n                                      const newInputs = { ...springBoneInputs };\n                                      if (!newInputs[bone.name])\n                                        newInputs[bone.name] = {\n                                          dragForce: \"\",\n                                          gravityPower: \"\",\n                                          hitRadius: \"\",\n                                          stiffness: \"\",\n                                          gravityDirX: \"\",\n                                          gravityDirY: \"\",\n                                          gravityDirZ: \"\",\n                                        };\n                                      newInputs[bone.name].gravityDirX =\n                                        e.target.value;\n                                      setSpringBoneInputs(newInputs);\n                                    }}\n                                    className=\"w-full h-7 text-xs\"\n                                  />\n                                </div>\n                                <div>\n                                  <Label className=\"text-xs text-muted-foreground\">\n                                    Y\n                                  </Label>\n                                  <Input\n                                    type=\"text\"\n                                    inputMode=\"decimal\"\n                                    value={\n                                      springBoneInputs[bone.name]\n                                        ?.gravityDirY || \"0\"\n                                    }\n                                    onChange={(e) => {\n                                      const newInputs = { ...springBoneInputs };\n                                      if (!newInputs[bone.name])\n                                        newInputs[bone.name] = {\n                                          dragForce: \"\",\n                                          gravityPower: \"\",\n                                          hitRadius: \"\",\n                                          stiffness: \"\",\n                                          gravityDirX: \"\",\n                                          gravityDirY: \"\",\n                                          gravityDirZ: \"\",\n                                        };\n                                      newInputs[bone.name].gravityDirY =\n                                        e.target.value;\n                                      setSpringBoneInputs(newInputs);\n                                    }}\n                                    className=\"w-full h-7 text-xs\"\n                                  />\n                                </div>\n                                <div>\n                                  <Label className=\"text-xs text-muted-foreground\">\n                                    Z\n                                  </Label>\n                                  <Input\n                                    type=\"text\"\n                                    inputMode=\"decimal\"\n                                    value={\n                                      springBoneInputs[bone.name]\n                                        ?.gravityDirZ || \"0\"\n                                    }\n                                    onChange={(e) => {\n                                      const newInputs = { ...springBoneInputs };\n                                      if (!newInputs[bone.name])\n                                        newInputs[bone.name] = {\n                                          dragForce: \"\",\n                                          gravityPower: \"\",\n                                          hitRadius: \"\",\n                                          stiffness: \"\",\n                                          gravityDirX: \"\",\n                                          gravityDirY: \"\",\n                                          gravityDirZ: \"\",\n                                        };\n                                      newInputs[bone.name].gravityDirZ =\n                                        e.target.value;\n                                      setSpringBoneInputs(newInputs);\n                                    }}\n                                    className=\"w-full h-7 text-xs\"\n                                  />\n                                </div>\n                              </div>\n                            </div>\n                          </AccordionContent>\n                        </AccordionItem>\n                      ))}\n                    </Accordion>\n                  </div>\n                )}\n              </AccordionContent>\n            </AccordionItem>\n\n            {/* Expressions Controls */}\n            <AccordionItem value=\"expressions\">\n              <AccordionTrigger className=\"px-4 py-3 text-base font-semibold\">\n                Expressions\n              </AccordionTrigger>\n              <AccordionContent className=\"px-4 pb-4\">\n                {expressions.length === 0 ? (\n                  <p className=\"text-sm text-muted-foreground\">\n                    No expressions available\n                  </p>\n                ) : (\n                  <div\n                    className={\n                      expressions.length > 10\n                        ? \"bg-secondary/50 rounded-lg p-3 max-h-[400px] overflow-y-auto\"\n                        : \"\"\n                    }\n                  >\n                    <div className=\"space-y-3 pl-2\">\n                      {expressions.map((expression) => (\n                        <div key={expression.name} className=\"space-y-1\">\n                          <div className=\"flex items-center justify-between\">\n                            <Label className=\"text-xs\">{expression.name}</Label>\n                            <Input\n                              type=\"text\"\n                              inputMode=\"decimal\"\n                              value={expressionInputs[expression.name] || \"0\"}\n                              onChange={(e) =>\n                                handleExpressionInputChange(\n                                  expression.name,\n                                  e.target.value\n                                )\n                              }\n                              onBlur={() =>\n                                handleExpressionInputBlur(\n                                  expression.name,\n                                  expression.value\n                                )\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  e.currentTarget.blur();\n                                }\n                              }}\n                              className=\"w-16 h-7 text-xs\"\n                            />\n                          </div>\n                          <Slider\n                            min={0}\n                            max={1}\n                            step={0.01}\n                            value={[expression.value]}\n                            onValueChange={([value]) =>\n                              onExpressionChange?.(expression.name, value)\n                            }\n                          />\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </AccordionContent>\n            </AccordionItem>\n\n            {/* ShapeKeys Controls */}\n            <AccordionItem value=\"shapekeys\">\n              <AccordionTrigger className=\"px-4 py-3 text-base font-semibold\">\n                Shapekeys\n              </AccordionTrigger>\n              <AccordionContent className=\"px-4 pb-4\">\n                {shapeKeys.length === 0 ? (\n                  <p className=\"text-sm text-muted-foreground\">\n                    No shapekeys available\n                  </p>\n                ) : (\n                  <div\n                    className={\n                      shapeKeys.length > 10\n                        ? \"bg-secondary/50 rounded-lg p-3 max-h-[400px] overflow-y-auto\"\n                        : \"\"\n                    }\n                  >\n                    <div className=\"space-y-3 pl-2\">\n                      {shapeKeys.map((shapeKey) => (\n                        <div key={shapeKey.name} className=\"space-y-1\">\n                          <div className=\"flex items-center justify-between\">\n                            <Label className=\"text-xs\">{shapeKey.name}</Label>\n                            <Input\n                              type=\"text\"\n                              inputMode=\"decimal\"\n                              value={shapeKeyInputs[shapeKey.name] || \"0\"}\n                              onChange={(e) =>\n                                handleShapeKeyInputChange(\n                                  shapeKey.name,\n                                  e.target.value\n                                )\n                              }\n                              onBlur={() =>\n                                handleShapeKeyInputBlur(\n                                  shapeKey.name,\n                                  shapeKey.value\n                                )\n                              }\n                              onKeyDown={(e) => {\n                                if (e.key === \"Enter\") {\n                                  e.currentTarget.blur();\n                                }\n                              }}\n                              className=\"w-16 h-7 text-xs\"\n                            />\n                          </div>\n                          <Slider\n                            min={0}\n                            max={1}\n                            step={0.01}\n                            value={[shapeKey.value]}\n                            onValueChange={([value]) =>\n                              onShapeKeyChange?.(shapeKey.name, value)\n                            }\n                          />\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </AccordionContent>\n            </AccordionItem>\n          </Accordion>\n\n          {/* Close Control Button */}\n          <div className=\"p-4 border-t\">\n            <Button\n              onClick={() => setShowControls(false)}\n              variant=\"outline\"\n              className=\"w-full\"\n            >\n              Close Control\n            </Button>\n          </div>\n        </div>\n      ) : (\n        /* Open Control Button */\n        <div className=\"absolute top-20 right-4 z-[45]\">\n          <Button\n            onClick={() => setShowControls(true)}\n            variant=\"default\"\n            size=\"sm\"\n          >\n            Open Control\n          </Button>\n        </div>\n      )}\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3232, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/ui/shadcn-io/dock/index.tsx"],"sourcesContent":["\"use client\";\n\nimport {\n  motion,\n  MotionValue,\n  useMotionValue,\n  useSpring,\n  useTransform,\n  type SpringOptions,\n  AnimatePresence,\n} from \"framer-motion\";\nimport {\n  Children,\n  cloneElement,\n  createContext,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { cn } from \"@/lib/utils\";\n\nconst DOCK_HEIGHT = 128;\nconst DEFAULT_MAGNIFICATION = 80;\nconst DEFAULT_DISTANCE = 150;\nconst DEFAULT_PANEL_HEIGHT = 80;\n\ntype DockProps = {\n  children: React.ReactNode;\n  className?: string;\n  distance?: number;\n  panelHeight?: number;\n  magnification?: number;\n  spring?: SpringOptions;\n};\ntype DockItemProps = {\n  className?: string;\n  children: React.ReactNode;\n};\ntype DockLabelProps = {\n  className?: string;\n  children: React.ReactNode;\n};\ntype DockIconProps = {\n  className?: string;\n  children: React.ReactNode;\n};\n\ntype DocContextType = {\n  mouseX: MotionValue;\n  spring: SpringOptions;\n  magnification: number;\n  distance: number;\n};\ntype DockProviderProps = {\n  children: React.ReactNode;\n  value: DocContextType;\n};\n\nconst DockContext = createContext<DocContextType | undefined>(undefined);\n\nfunction DockProvider({ children, value }: DockProviderProps) {\n  return <DockContext.Provider value={value}>{children}</DockContext.Provider>;\n}\n\nfunction useDock() {\n  const context = useContext(DockContext);\n  if (!context) {\n    throw new Error(\"useDock must be used within an DockProvider\");\n  }\n  return context;\n}\n\nfunction Dock({\n  children,\n  className,\n  spring = { mass: 0.1, stiffness: 150, damping: 12 },\n  magnification = DEFAULT_MAGNIFICATION,\n  distance = DEFAULT_DISTANCE,\n  panelHeight = DEFAULT_PANEL_HEIGHT,\n}: DockProps) {\n  const mouseX = useMotionValue(Infinity);\n  const isHovered = useMotionValue(0);\n\n  const maxHeight = useMemo(() => {\n    return Math.max(DOCK_HEIGHT, magnification + magnification / 2 + 4);\n  }, [magnification]);\n\n  const heightRow = useTransform(isHovered, [0, 1], [panelHeight, maxHeight]);\n  const height = useSpring(heightRow, spring);\n\n  return (\n    <motion.div\n      style={{\n        height: height,\n        scrollbarWidth: \"none\",\n      }}\n      className=\"mx-2 flex max-w-full items-end overflow-x-auto\"\n    >\n      <motion.div\n        onMouseMove={({ pageX }) => {\n          isHovered.set(1);\n          mouseX.set(pageX);\n        }}\n        onMouseLeave={() => {\n          isHovered.set(0);\n          mouseX.set(Infinity);\n        }}\n        className={cn(\n          \"mx-auto flex w-fit gap-4 rounded-2xl bg-gray-50 px-4 dark:bg-neutral-900\",\n          className\n        )}\n        style={{ height: panelHeight }}\n        role=\"toolbar\"\n        aria-label=\"Application dock\"\n      >\n        <DockProvider value={{ mouseX, spring, distance, magnification }}>\n          {children}\n        </DockProvider>\n      </motion.div>\n    </motion.div>\n  );\n}\n\nfunction DockItem({ children, className }: DockItemProps) {\n  const ref = useRef<HTMLDivElement>(null);\n\n  const { distance, magnification, mouseX, spring } = useDock();\n\n  const isHovered = useMotionValue(0);\n\n  const mouseDistance = useTransform(mouseX, (val) => {\n    const domRect = ref.current?.getBoundingClientRect() ?? { x: 0, width: 0 };\n    return val - domRect.x - domRect.width / 2;\n  });\n\n  const widthTransform = useTransform(\n    mouseDistance,\n    [-distance, 0, distance],\n    [56, magnification, 56]\n  );\n\n  const width = useSpring(widthTransform, spring);\n\n  return (\n    <motion.div\n      ref={ref}\n      style={{ width }}\n      onHoverStart={() => isHovered.set(1)}\n      onHoverEnd={() => isHovered.set(0)}\n      onFocus={() => isHovered.set(1)}\n      onBlur={() => isHovered.set(0)}\n      className={cn(\n        \"relative inline-flex items-center justify-center\",\n        className\n      )}\n      tabIndex={0}\n      role=\"button\"\n      aria-haspopup=\"true\"\n    >\n      {Children.map(children, (child) =>\n        cloneElement(child as React.ReactElement<any>, { width, isHovered })\n      )}\n    </motion.div>\n  );\n}\n\nfunction DockLabel({ children, className, ...rest }: DockLabelProps) {\n  const restProps = rest as Record<string, unknown>;\n  const isHovered = restProps[\"isHovered\"] as MotionValue<number>;\n  const [isVisible, setIsVisible] = useState(false);\n\n  useEffect(() => {\n    const unsubscribe = isHovered.on(\"change\", (latest) => {\n      setIsVisible(latest === 1);\n    });\n\n    return () => unsubscribe();\n  }, [isHovered]);\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <motion.div\n          initial={{ opacity: 0, y: 0 }}\n          animate={{ opacity: 1, y: -10 }}\n          exit={{ opacity: 0, y: 0 }}\n          transition={{ duration: 0.2 }}\n          className={cn(\n            \"absolute -top-6 left-1/2 w-fit whitespace-pre rounded-md border border-gray-200 bg-gray-100 px-2 py-0.5 text-xs text-neutral-700 dark:border-neutral-900 dark:bg-neutral-800 dark:text-white\",\n            className\n          )}\n          role=\"tooltip\"\n          style={{ x: \"-50%\" }}\n        >\n          {children}\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n\nfunction DockIcon({ children, className, ...rest }: DockIconProps) {\n  const restProps = rest as Record<string, unknown>;\n  const width = restProps[\"width\"] as MotionValue<number>;\n\n  const widthTransform = useTransform(width, (val) => val / 2);\n\n  return (\n    <motion.div\n      style={{ width: widthTransform }}\n      className={cn(\"flex items-center justify-center\", className)}\n    >\n      {children}\n    </motion.div>\n  );\n}\n\nexport { Dock, DockIcon, DockItem, DockLabel };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3453, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/ui/dropdown-menu.tsx"],"sourcesContent":["import * as React from \"react\";\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\";\nimport { Check } from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst DropdownMenu = DropdownMenuPrimitive.Root;\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger;\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group;\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal;\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub;\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup;\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean;\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm font-medium outline-none focus:bg-accent data-[state=open]:bg-accent\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n));\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName;\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n));\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName;\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n));\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName;\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean;\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n));\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName;\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-pointer select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n));\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName;\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-pointer select-none items-center rounded-sm py-1.5 px-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n));\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName;\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean;\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n));\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName;\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n));\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName;\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => (\n  <span\n    className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n    {...props}\n  />\n);\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\";\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3627, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/assets/index.tsx"],"sourcesContent":["interface IconProps {\n  className?: string;\n}\n\nexport const ChatIcon = ({ className }: IconProps) => (\n  <svg\n    viewBox=\"0 0 511.998 511.998\"\n    className={className}\n    fill=\"currentColor\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M418.643,21.318H221.353c-51.547,0-93.355,41.807-93.355,93.355v13.312H93.355C41.807,127.984,0,169.792,0,221.339\n\t\t\t\tv88.683c0,55.289,26.377,95.296,76.864,95.296h8.469v64c0,22.932,31.239,29.714,40.747,8.845\n\t\t\t\tc7.211-15.827,19.353-30.833,35.143-44.611c9.913-8.65,20.621-16.265,31.321-22.725c3.835-2.315,7.11-4.157,9.649-5.509h75.14\n\t\t\t\tc52.857,0,106.667-44.46,106.667-95.296v-11.371h51.134c50.487,0,76.864-40.007,76.864-95.296v-88.683\n\t\t\t\tC511.998,63.119,470.206,21.318,418.643,21.318z M277.333,362.651H197.12c-3.133,0-6.227,0.69-9.063,2.021\n\t\t\t\tc-3.758,1.764-9.867,4.982-17.563,9.628c-12.7,7.667-25.394,16.695-37.322,27.103c-1.756,1.533-3.481,3.081-5.172,4.647v-22.065\n\t\t\t\tc0-11.782-9.551-21.333-21.333-21.333H76.864c-22.276,0-34.197-18.081-34.197-52.629v-88.683\n\t\t\t\tc0-27.983,22.705-50.688,50.688-50.688h55.977h141.312c1.198,0,2.383,0.057,3.56,0.138c21.165,1.471,38.766,15.936,44.849,35.478\n\t\t\t\tc1.481,4.761,2.279,9.823,2.279,15.072v55.979c0,0.015,0.002,0.029,0.002,0.044v32.661\n\t\t\t\tC341.333,335.302,308.233,362.651,277.333,362.651z M469.331,203.355c0,34.548-11.921,52.629-34.197,52.629H384v-34.645\n\t\t\t\tc0-9.74-1.495-19.131-4.264-27.959c-11.505-36.697-45.057-63.637-85.143-65.306c-1.31-0.055-2.625-0.089-3.948-0.089h-0.002\n\t\t\t\tH170.665v-13.312c0-27.983,22.705-50.688,50.688-50.688h197.291c27.996,0,50.688,22.696,50.688,50.688V203.355z\"\n    />\n    <path\n      d=\"M192,234.651c-11.776,0-21.333,9.557-21.333,21.333c0,11.776,9.557,21.333,21.333,21.333s21.333-9.557,21.333-21.333\n\t\t\t\tC213.333,244.208,203.776,234.651,192,234.651z\"\n    />\n    <path\n      d=\"M277.333,234.651c-11.776,0-21.333,9.557-21.333,21.333c0,11.776,9.557,21.333,21.333,21.333s21.333-9.557,21.333-21.333\n\t\t\t\tC298.667,244.208,289.109,234.651,277.333,234.651z\"\n    />\n    <path\n      d=\"M106.667,234.651c-11.776,0-21.333,9.557-21.333,21.333c0,11.776,9.557,21.333,21.333,21.333S128,267.76,128,255.984\n\t\t\t\tC128,244.208,118.443,234.651,106.667,234.651z\"\n    />\n  </svg>\n);\n\nexport const ThreeDIcon = ({ className }: IconProps) => (\n  <svg\n    viewBox=\"0 0 24 24\"\n    className={className}\n    fill=\"currentColor\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M11.5144 1.12584C11.8164 0.958052 12.1836 0.958052 12.4856 1.12584L21.4845 6.12522C21.4921 6.12942 21.4996 6.13372 21.5071 6.13813C21.8125 6.31781 22 6.64568 22 7V17C22 17.3632 21.8031 17.6978 21.4856 17.8742L12.4856 22.8742C12.1791 23.0445 11.8059 23.0416 11.5022 22.8673L2.51436 17.874C2.19689 17.6977 2 17.3631 2 16.9999V7C2 6.64568 2.18749 6.3177 2.49287 6.13802L2.5073 6.13784L2.51436 6.12584L11.5144 1.12584ZM12.0001 10.856L5.05923 6.99995L12 3.14396L18.9409 7L12.0001 10.856ZM4 8.69951V16.4115L11 20.3004V12.5884L4 8.69951ZM13 12.5884V20.3005L20 16.4116V8.69951L13 12.5884Z\"\n    />\n  </svg>\n);\n"],"names":[],"mappings":";;;;;;;;AAIO,MAAM,WAAW,CAAC,EAAE,SAAS,EAAa,iBAC/C,8OAAC;QACC,SAAQ;QACR,WAAW;QACX,MAAK;QACL,OAAM;;0BAEN,8OAAC;gBACC,GAAE;;;;;;0BAaJ,8OAAC;gBACC,GAAE;;;;;;0BAGJ,8OAAC;gBACC,GAAE;;;;;;0BAGJ,8OAAC;gBACC,GAAE;;;;;;;;;;;;AAMD,MAAM,aAAa,CAAC,EAAE,SAAS,EAAa,iBACjD,8OAAC;QACC,SAAQ;QACR,WAAW;QACX,MAAK;QACL,OAAM;kBAEN,cAAA,8OAAC;YACC,UAAS;YACT,UAAS;YACT,GAAE"}},
    {"offset": {"line": 3698, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/DockMenu.tsx"],"sourcesContent":["import {\n  Dock,\n  DockIcon,\n  DockItem,\n  DockLabel,\n} from \"@/components/ui/shadcn-io/dock\";\nimport { Mic, Home, ChevronDown } from \"lucide-react\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuTrigger,\n  DropdownMenuRadioItem,\n} from \"@/components/ui/dropdown-menu\";\nimport { ChatIcon, ThreeDIcon } from \"@/assets\";\n\ninterface DockMenuProps {\n  isRecording?: boolean;\n  audioInputs?: MediaDeviceInfo[];\n  onToggleRecording?: () => void;\n  onSelectAudioInput?: (deviceId: string) => void;\n  onNavigateHome?: () => void;\n  onOpenChatPrompt?: () => void;\n  onOpenAvatarModal?: () => void;\n}\n\nexport const DockMenu = ({\n  isRecording = false,\n  audioInputs = [],\n  onToggleRecording,\n  onSelectAudioInput,\n  onNavigateHome,\n  onOpenChatPrompt,\n  onOpenAvatarModal,\n}: DockMenuProps) => {\n  return (\n    <footer className=\"absolute bottom-0 left-0 right-0 z-10 flex justify-center items-end pb-4 lg:left-64\">\n      {/* Dock with Action Buttons */}\n      <Dock magnification={100} distance={140}>\n        {/* Home Button */}\n        <DockItem>\n          <DockLabel>Home</DockLabel>\n          <DockIcon>\n            <button\n              onClick={onNavigateHome}\n              className=\"h-full w-full flex items-center justify-center\"\n            >\n              <Home className=\"h-full w-full text-foreground\" />\n            </button>\n          </DockIcon>\n        </DockItem>\n\n        {/* Record Button with Microphone Selector */}\n        {onToggleRecording && (\n          <DockItem className={isRecording ? \"animate-pulse\" : \"\"}>\n            <DockLabel>{isRecording ? \"Stop\" : \"Record\"}</DockLabel>\n            <DockIcon>\n              <div className=\"h-full w-full flex items-center justify-center relative\">\n                <button\n                  onClick={onToggleRecording}\n                  className=\"h-full w-full flex items-center justify-center\"\n                >\n                  <Mic\n                    className={`h-full w-full ${\n                      isRecording ? \"text-red-500\" : \"text-foreground\"\n                    }`}\n                  />\n                </button>\n                {/* Microphone Selector Dropdown */}\n                {audioInputs.length > 0 && (\n                  <DropdownMenu>\n                    <DropdownMenuTrigger asChild>\n                      <button className=\"absolute right-0 top-1/2 -translate-y-1/2 translate-x-[calc(50%+8px)] flex items-center justify-center hover:opacity-70\">\n                        <ChevronDown className=\"h-4 w-4 text-foreground\" />\n                      </button>\n                    </DropdownMenuTrigger>\n                    <DropdownMenuContent align=\"start\">\n                      {audioInputs.map((device) => (\n                        <DropdownMenuRadioItem\n                          key={device.deviceId}\n                          value={device.deviceId}\n                          onClick={() => onSelectAudioInput?.(device.deviceId)}\n                        >\n                          {device.label ||\n                            `Microphone (${device.deviceId.slice(0, 5)})`}\n                        </DropdownMenuRadioItem>\n                      ))}\n                    </DropdownMenuContent>\n                  </DropdownMenu>\n                )}\n              </div>\n            </DockIcon>\n          </DockItem>\n        )}\n\n        {/* Chat Button */}\n        {onOpenChatPrompt && (\n          <DockItem>\n            <DockLabel>Chat</DockLabel>\n            <DockIcon>\n              <button\n                onClick={onOpenChatPrompt}\n                className=\"h-full w-full flex items-center justify-center\"\n              >\n                <ChatIcon className=\"h-full w-full text-foreground\" />\n              </button>\n            </DockIcon>\n          </DockItem>\n        )}\n\n        {/* 3D Model Button */}\n        {onOpenAvatarModal && (\n          <DockItem>\n            <DockLabel>3D Avatar</DockLabel>\n            <DockIcon>\n              <button\n                onClick={onOpenAvatarModal}\n                className=\"h-full w-full flex items-center justify-center\"\n              >\n                <ThreeDIcon className=\"h-full w-full text-foreground\" />\n              </button>\n            </DockIcon>\n          </DockItem>\n        )}\n      </Dock>\n    </footer>\n  );\n};\n"],"names":[],"mappings":";;;;;AAAA;AAMA;AAAA;AAAA;AACA;AAMA;;;;;;AAYO,MAAM,WAAW,CAAC,EACvB,cAAc,KAAK,EACnB,cAAc,EAAE,EAChB,iBAAiB,EACjB,kBAAkB,EAClB,cAAc,EACd,gBAAgB,EAChB,iBAAiB,EACH;IACd,qBACE,8OAAC;QAAO,WAAU;kBAEhB,cAAA,8OAAC,0JAAI;YAAC,eAAe;YAAK,UAAU;;8BAElC,8OAAC,8JAAQ;;sCACP,8OAAC,+JAAS;sCAAC;;;;;;sCACX,8OAAC,8JAAQ;sCACP,cAAA,8OAAC;gCACC,SAAS;gCACT,WAAU;0CAEV,cAAA,8OAAC,2MAAI;oCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;gBAMrB,mCACC,8OAAC,8JAAQ;oBAAC,WAAW,cAAc,kBAAkB;;sCACnD,8OAAC,+JAAS;sCAAE,cAAc,SAAS;;;;;;sCACnC,8OAAC,8JAAQ;sCACP,cAAA,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCACC,SAAS;wCACT,WAAU;kDAEV,cAAA,8OAAC,uMAAG;4CACF,WAAW,CAAC,cAAc,EACxB,cAAc,iBAAiB,mBAC/B;;;;;;;;;;;oCAIL,YAAY,MAAM,GAAG,mBACpB,8OAAC,qJAAY;;0DACX,8OAAC,4JAAmB;gDAAC,OAAO;0DAC1B,cAAA,8OAAC;oDAAO,WAAU;8DAChB,cAAA,8OAAC,mOAAW;wDAAC,WAAU;;;;;;;;;;;;;;;;0DAG3B,8OAAC,4JAAmB;gDAAC,OAAM;0DACxB,YAAY,GAAG,CAAC,CAAC,uBAChB,8OAAC,8JAAqB;wDAEpB,OAAO,OAAO,QAAQ;wDACtB,SAAS,IAAM,qBAAqB,OAAO,QAAQ;kEAElD,OAAO,KAAK,IACX,CAAC,YAAY,EAAE,OAAO,QAAQ,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC,CAAC;uDAL1C,OAAO,QAAQ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;gBAiBrC,kCACC,8OAAC,8JAAQ;;sCACP,8OAAC,+JAAS;sCAAC;;;;;;sCACX,8OAAC,8JAAQ;sCACP,cAAA,8OAAC;gCACC,SAAS;gCACT,WAAU;0CAEV,cAAA,8OAAC,4HAAQ;oCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;gBAO3B,mCACC,8OAAC,8JAAQ;;sCACP,8OAAC,+JAAS;sCAAC;;;;;;sCACX,8OAAC,8JAAQ;sCACP,cAAA,8OAAC;gCACC,SAAS;gCACT,WAAU;0CAEV,cAAA,8OAAC,8HAAU;oCAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQtC"}},
    {"offset": {"line": 3936, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/ui/select.tsx"],"sourcesContent":["import * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAAA;AAAA;AAEA;;;;;;AAEA,MAAM,SAAS,0KAAoB;AAEnC,MAAM,cAAc,2KAAqB;AAEzC,MAAM,cAAc,2KAAqB;AAEzC,MAAM,8BAAgB,mNAAgB,CAGpC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpC,8OAAC,6KAAuB;QACtB,KAAK;QACL,WAAW,IAAA,kHAAE,EACX,kUACA;QAED,GAAG,KAAK;;YAER;0BACD,8OAAC,0KAAoB;gBAAC,OAAO;0BAC3B,cAAA,8OAAC,mOAAW;oBAAC,WAAU;;;;;;;;;;;;;;;;;AAI7B,cAAc,WAAW,GAAG,6KAAuB,CAAC,WAAW;AAE/D,MAAM,qCAAuB,mNAAgB,CAG3C,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,oLAA8B;QAC7B,KAAK;QACL,WAAW,IAAA,kHAAE,EACX,wDACA;QAED,GAAG,KAAK;kBAET,cAAA,8OAAC,6NAAS;YAAC,WAAU;;;;;;;;;;;AAGzB,qBAAqB,WAAW,GAAG,oLAA8B,CAAC,WAAW;AAE7E,MAAM,uCAAyB,mNAAgB,CAG7C,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,sLAAgC;QAC/B,KAAK;QACL,WAAW,IAAA,kHAAE,EACX,wDACA;QAED,GAAG,KAAK;kBAET,cAAA,8OAAC,mOAAW;YAAC,WAAU;;;;;;;;;;;AAG3B,uBAAuB,WAAW,GAChC,sLAAgC,CAAC,WAAW;AAE9C,MAAM,8BAAgB,mNAAgB,CAGpC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,WAAW,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACzD,8OAAC,4KAAsB;kBACrB,cAAA,8OAAC,6KAAuB;YACtB,KAAK;YACL,WAAW,IAAA,kHAAE,EACX,ijBACA,aAAa,YACX,mIACF;YAEF,UAAU;YACT,GAAG,KAAK;;8BAET,8OAAC;;;;;8BACD,8OAAC,8KAAwB;oBACvB,WAAW,IAAA,kHAAE,EACX,OACA,aAAa,YACX;8BAGH;;;;;;8BAEH,8OAAC;;;;;;;;;;;;;;;;AAIP,cAAc,WAAW,GAAG,6KAAuB,CAAC,WAAW;AAE/D,MAAM,4BAAc,mNAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,2KAAqB;QACpB,KAAK;QACL,WAAW,IAAA,kHAAE,EAAC,qCAAqC;QAClD,GAAG,KAAK;;;;;;AAGb,YAAY,WAAW,GAAG,2KAAqB,CAAC,WAAW;AAE3D,MAAM,2BAAa,mNAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpC,8OAAC,0KAAoB;QACnB,KAAK;QACL,WAAW,IAAA,kHAAE,EACX,6NACA;QAED,GAAG,KAAK;;0BAET,8OAAC;gBAAK,WAAU;0BACd,cAAA,8OAAC,mLAA6B;8BAC5B,cAAA,8OAAC,6MAAK;wBAAC,WAAU;;;;;;;;;;;;;;;;0BAGrB,8OAAC,8KAAwB;0BAAE;;;;;;;;;;;;AAG/B,WAAW,WAAW,GAAG,0KAAoB,CAAC,WAAW;AAEzD,MAAM,gCAAkB,mNAAgB,CAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,+KAAyB;QACxB,KAAK;QACL,WAAW,IAAA,kHAAE,EAAC,4BAA4B;QACzC,GAAG,KAAK;;;;;;AAGb,gBAAgB,WAAW,GAAG,+KAAyB,CAAC,WAAW"}},
    {"offset": {"line": 4135, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/ui/textarea.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;AAEA,MAAM,yBAAW,mNAAgB,CAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IAC1B,qBACE,8OAAC;QACC,WAAW,IAAA,kHAAE,EACX,6QACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AACA,SAAS,WAAW,GAAG"}},
    {"offset": {"line": 4162, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/ui/shadcn-io/ai/prompt-input.tsx"],"sourcesContent":["\"use client\";\n\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { cn } from \"@/lib/utils\";\nimport type { ChatStatus } from \"ai\";\nimport { Loader2Icon, SendIcon, SquareIcon, XIcon } from \"lucide-react\";\nimport type {\n  ComponentProps,\n  HTMLAttributes,\n  KeyboardEventHandler,\n} from \"react\";\nimport { Children, useRef, useEffect } from \"react\";\n\nexport type PromptInputProps = HTMLAttributes<HTMLFormElement>;\n\nexport const PromptInput = ({ className, ...props }: PromptInputProps) => (\n  <form\n    className={cn(\n      \"w-full divide-y overflow-hidden rounded-xl border bg-background shadow-sm\",\n      className\n    )}\n    {...(props as any)}\n  />\n);\n\nexport type PromptInputTextareaProps = ComponentProps<typeof Textarea> & {\n  minHeight?: number;\n  maxHeight?: number;\n};\n\nexport const PromptInputTextarea = ({\n  onChange,\n  className,\n  placeholder = \"What would you like to know?\",\n  minHeight = 48,\n  maxHeight = 164,\n  ...props\n}: PromptInputTextareaProps) => {\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n\n  const handleKeyDown: KeyboardEventHandler<HTMLTextAreaElement> = (e) => {\n    if (e.key === \"Enter\") {\n      if (e.shiftKey) {\n        // Allow newline\n        return;\n      }\n\n      // Submit on Enter (without Shift)\n      e.preventDefault();\n      const form = e.currentTarget.form;\n      if (form) {\n        form.requestSubmit();\n      }\n    }\n  };\n\n  // Auto-resize textarea based on content\n  useEffect(() => {\n    const textarea = textareaRef.current;\n    if (!textarea) return;\n\n    const adjustHeight = () => {\n      textarea.style.height = \"auto\";\n      const newHeight = Math.min(\n        Math.max(textarea.scrollHeight, minHeight),\n        maxHeight\n      );\n      textarea.style.height = `${newHeight}px`;\n    };\n\n    adjustHeight();\n  }, [props.value, minHeight, maxHeight]);\n\n  return (\n    <Textarea\n      ref={textareaRef}\n      className={cn(\n        \"w-full resize-none rounded-none border-none p-3 shadow-none outline-none ring-0\",\n        \"field-sizing-content max-h-[6lh] bg-transparent dark:bg-transparent\",\n        \"focus-visible:ring-0\",\n        className\n      )}\n      name=\"message\"\n      onChange={(e) => {\n        onChange?.(e);\n      }}\n      onKeyDown={handleKeyDown}\n      placeholder={placeholder}\n      {...(props as any)}\n    />\n  );\n};\n\nexport type PromptInputToolbarProps = HTMLAttributes<HTMLDivElement>;\n\nexport const PromptInputToolbar = ({\n  className,\n  ...props\n}: PromptInputToolbarProps) => (\n  <div\n    className={cn(\"flex items-center justify-between p-1\", className)}\n    {...(props as any)}\n  />\n);\n\nexport type PromptInputToolsProps = HTMLAttributes<HTMLDivElement>;\n\nexport const PromptInputTools = ({\n  className,\n  ...props\n}: PromptInputToolsProps) => (\n  <div\n    className={cn(\n      \"flex items-center gap-1\",\n      \"[&_button:first-child]:rounded-bl-xl\",\n      className\n    )}\n    {...(props as any)}\n  />\n);\n\nexport type PromptInputButtonProps = ComponentProps<typeof Button>;\n\nexport const PromptInputButton = ({\n  variant = \"ghost\",\n  className,\n  size,\n  ...props\n}: PromptInputButtonProps) => {\n  const newSize =\n    size ?? Children.count(props.children) > 1 ? \"default\" : \"icon\";\n\n  return (\n    <Button\n      className={cn(\n        \"shrink-0 gap-1.5 rounded-lg\",\n        variant === \"ghost\" && \"text-muted-foreground\",\n        newSize === \"default\" && \"px-3\",\n        className\n      )}\n      size={newSize}\n      type=\"button\"\n      variant={variant}\n      {...(props as any)}\n    />\n  );\n};\n\nexport type PromptInputSubmitProps = ComponentProps<typeof Button> & {\n  status?: ChatStatus;\n};\n\nexport const PromptInputSubmit = ({\n  className,\n  variant = \"default\",\n  size = \"icon\",\n  status,\n  children,\n  ...props\n}: PromptInputSubmitProps) => {\n  let Icon = <SendIcon className=\"size-4\" />;\n\n  if (status === \"submitted\") {\n    Icon = <Loader2Icon className=\"size-4 animate-spin\" />;\n  } else if (status === \"streaming\") {\n    Icon = <SquareIcon className=\"size-4\" />;\n  } else if (status === \"error\") {\n    Icon = <XIcon className=\"size-4\" />;\n  }\n\n  return (\n    <Button\n      className={cn(\"gap-1.5 rounded-lg\", className)}\n      size={size}\n      type=\"submit\"\n      variant={variant}\n      {...(props as any)}\n    >\n      {children ?? Icon}\n    </Button>\n  );\n};\n\nexport type PromptInputModelSelectProps = ComponentProps<typeof Select>;\n\nexport const PromptInputModelSelect = (props: PromptInputModelSelectProps) => (\n  <Select {...(props as any)} />\n);\n\nexport type PromptInputModelSelectTriggerProps = ComponentProps<\n  typeof SelectTrigger\n>;\n\nexport const PromptInputModelSelectTrigger = ({\n  className,\n  ...props\n}: PromptInputModelSelectTriggerProps) => (\n  <SelectTrigger\n    className={cn(\n      \"border-none bg-transparent font-medium text-muted-foreground shadow-none transition-colors\",\n      'hover:bg-accent hover:text-foreground [&[aria-expanded=\"true\"]]:bg-accent [&[aria-expanded=\"true\"]]:text-foreground',\n      className\n    )}\n    {...(props as any)}\n  />\n);\n\nexport type PromptInputModelSelectContentProps = ComponentProps<\n  typeof SelectContent\n>;\n\nexport const PromptInputModelSelectContent = ({\n  className,\n  ...props\n}: PromptInputModelSelectContentProps) => (\n  <SelectContent className={cn(className)} {...(props as any)} />\n);\n\nexport type PromptInputModelSelectItemProps = ComponentProps<typeof SelectItem>;\n\nexport const PromptInputModelSelectItem = ({\n  className,\n  ...props\n}: PromptInputModelSelectItemProps) => (\n  <SelectItem className={cn(className)} {...(props as any)} />\n);\n\nexport type PromptInputModelSelectValueProps = ComponentProps<\n  typeof SelectValue\n>;\n\nexport const PromptInputModelSelectValue = ({\n  className,\n  ...props\n}: PromptInputModelSelectValueProps) => (\n  <SelectValue className={cn(className)} {...(props as any)} />\n);\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4378, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/ChatPrompt.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useRef, type FormEventHandler } from \"react\";\nimport {\n  PromptInput,\n  PromptInputButton,\n  PromptInputModelSelect,\n  PromptInputModelSelectContent,\n  PromptInputModelSelectItem,\n  PromptInputModelSelectTrigger,\n  PromptInputModelSelectValue,\n  PromptInputSubmit,\n  PromptInputTextarea,\n  PromptInputToolbar,\n  PromptInputTools,\n} from \"@/components/ui/shadcn-io/ai/prompt-input\";\nimport { Paperclip, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface ChatPromptProps {\n  open: boolean;\n  onClose: () => void;\n  onAudioGenerated?: (audioUrl: string) => void;\n}\n\nexport const ChatPrompt = ({\n  open,\n  onClose,\n  onAudioGenerated,\n}: ChatPromptProps) => {\n  const [text, setText] = useState(\"\");\n  const [selectedModel, setSelectedModel] = useState(\"mistral:7b\");\n  const [availableModels, setAvailableModels] = useState<string[]>([]);\n  const [status, setStatus] = useState<\n    \"submitted\" | \"streaming\" | \"ready\" | \"error\"\n  >(\"ready\");\n  const [attachments, setAttachments] = useState<File[]>([]);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // Fetch available Ollama models\n  useEffect(() => {\n    const fetchModels = async () => {\n      try {\n        const response = await fetch(\"http://localhost:5004/models\");\n        if (!response.ok) {\n          throw new Error(`Server returned ${response.status}`);\n        }\n        const data = await response.json();\n        if (data.models && Array.isArray(data.models)) {\n          const modelNames = data.models.map(\n            (model: { name: string }) => model.name\n          );\n          if (modelNames.length > 0) {\n            setAvailableModels(modelNames);\n            setSelectedModel(modelNames[0]);\n          } else {\n            // No models returned, use fallback\n            setAvailableModels([\"mistral:7b\"]);\n          }\n        } else {\n          // Invalid response format, use fallback\n          setAvailableModels([\"mistral:7b\"]);\n        }\n      } catch (error) {\n        console.warn(\"Failed to fetch models (backend may be offline):\", error);\n        // Fallback to default model - don't crash the UI\n        setAvailableModels([\"mistral:7b\"]);\n      }\n    };\n\n    if (open) {\n      fetchModels();\n    }\n  }, [open]);\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    setAttachments((prev) => [...prev, ...files]);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = \"\";\n    }\n  };\n\n  const handleRemoveAttachment = (index: number) => {\n    setAttachments((prev) => prev.filter((_, i) => i !== index));\n  };\n\n  const handleSubmit: FormEventHandler<HTMLFormElement> = async (event) => {\n    event.preventDefault();\n    if (!text.trim()) {\n      return;\n    }\n\n    setStatus(\"submitted\");\n\n    try {\n      const userMessage = text.trim();\n\n      // Clear input immediately for better UX\n      setText(\"\");\n      setAttachments([]);\n\n      setTimeout(() => {\n        setStatus(\"streaming\");\n      }, 200);\n\n      // Step 1: Query RAG system for relevant context\n      console.log(\"ðŸ” Querying RAG system for context...\");\n      let ragContext = \"\";\n      try {\n        const ragResponse = await fetch(\"http://localhost:5003/query\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify({ query: userMessage }),\n        });\n\n        if (ragResponse.ok) {\n          const ragData = await ragResponse.json();\n          if (ragData.has_context) {\n            ragContext = ragData.context;\n            console.log(\n              \"âœ… RAG Context retrieved:\",\n              ragData.contexts?.length || 0,\n              \"chunks\"\n            );\n          } else {\n            console.log(\"â„¹ No relevant context found in documents\");\n          }\n        } else {\n          console.warn(\"âš  RAG server unavailable, continuing without context\");\n        }\n      } catch (error) {\n        console.warn(\"âš  RAG query failed:\", error);\n        console.log(\"  Continuing without document context...\");\n      }\n\n      // Step 2: Build system prompt with context\n      let systemPrompt =\n        \"Kamu adalah asisten AI yang membantu. Selalu jawab dalam Bahasa Indonesia yang sopan dan jelas. Berikan jawaban yang SINGKAT dan LANGSUNG KE INTI. Jangan memberikan penjelasan panjang kecuali diminta. Untuk pertanyaan sederhana, jawab dengan 1-2 kalimat saja.\";\n\n      if (ragContext) {\n        systemPrompt += `\\n\\nGunakan informasi berikut sebagai referensi untuk menjawab pertanyaan:\\n\\n${ragContext}\\n\\nJawab berdasarkan informasi di atas jika relevan dengan pertanyaan. Jika informasi tidak cukup atau tidak relevan, jawab berdasarkan pengetahuan umum.`;\n      }\n\n      // Step 3: Send to backend chat server\n      console.log(\"ðŸ¤– Sending to LLM...\");\n      \n      const chatMessages = [\n        { role: \"system\", content: systemPrompt },\n        { role: \"user\", content: userMessage },\n      ];\n\n      const response = await fetch(\"http://localhost:5004/chat\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          model: selectedModel,\n          messages: chatMessages,\n          stream: true,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Chat server error\");\n      }\n\n      const reader = response.body?.getReader();\n      const decoder = new TextDecoder();\n      let fullResponse = \"\";\n\n      while (reader) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        const chunk = decoder.decode(value);\n        const lines = chunk.split(\"\\n\").filter((line) => line.trim());\n\n        for (const line of lines) {\n          try {\n            const json = JSON.parse(line);\n            if (json.message?.content) {\n              fullResponse += json.message.content;\n            }\n          } catch {\n            // Skip invalid JSON\n          }\n        }\n      }\n      console.log(\"âœ… LLM Response:\", fullResponse);\n\n      // Step 4: Send LLM response to TTS server\n      console.log(\"ðŸ”Š Sending to TTS for speech synthesis...\");\n      const ttsResponse = await fetch(\"http://localhost:5002/synthesize\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ text: fullResponse }),\n      });\n\n      if (!ttsResponse.ok) {\n        throw new Error(\"TTS synthesis failed\");\n      }\n\n      const ttsAudioBlob = await ttsResponse.blob();\n      const audioUrl = URL.createObjectURL(ttsAudioBlob);\n      console.log(\"âœ… TTS audio generated\");\n\n      // Step 5: Trigger avatar to speak through callback\n      if (onAudioGenerated) {\n        onAudioGenerated(audioUrl);\n      }\n\n      setStatus(\"ready\");\n    } catch (error) {\n      console.error(\"âŒ Failed to process chat message:\", error);\n      setStatus(\"error\");\n      setTimeout(() => {\n        setStatus(\"ready\");\n      }, 2000);\n    }\n  };\n\n  return (\n    <div\n      className={`\n      fixed inset-0 z-50 flex items-end justify-center pointer-events-none\n      transition-opacity duration-300\n      ${open ? \"opacity-100\" : \"opacity-0 pointer-events-none\"}\n    `}\n    >\n      <div\n        ref={containerRef}\n        className={`\n          pointer-events-auto mb-32 w-[95vw] sm:w-[500px] md:w-[600px] lg:w-[700px] lg:translate-x-32\n          transition-all duration-300 ease-out\n          ${open ? \"translate-y-0 opacity-100\" : \"translate-y-8 opacity-0\"}\n        `}\n      >\n        <PromptInput onSubmit={handleSubmit}>\n          {attachments.length > 0 && (\n            <div className=\"flex flex-wrap gap-2 p-3 border-b\">\n              {attachments.map((file, index) => (\n                <div\n                  key={index}\n                  className=\"flex items-center gap-2 bg-muted rounded-md px-3 py-1.5 text-sm\"\n                >\n                  <span className=\"truncate max-w-[200px]\">{file.name}</span>\n                  <button\n                    type=\"button\"\n                    onClick={() => handleRemoveAttachment(index)}\n                    className=\"hover:bg-background rounded-sm p-0.5\"\n                  >\n                    <X className=\"h-3 w-3\" />\n                  </button>\n                </div>\n              ))}\n            </div>\n          )}\n          <PromptInputTextarea\n            onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) =>\n              setText(e.target.value)\n            }\n            value={text}\n            placeholder=\"Type your message...\"\n          />\n          <PromptInputToolbar>\n            <PromptInputTools>\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                multiple\n                onChange={handleFileSelect}\n                className=\"hidden\"\n              />\n              <PromptInputButton\n                type=\"button\"\n                onClick={() => fileInputRef.current?.click()}\n              >\n                <Paperclip className=\"h-4 w-4\" />\n              </PromptInputButton>\n              <PromptInputModelSelect\n                onValueChange={setSelectedModel}\n                value={selectedModel}\n              >\n                <PromptInputModelSelectTrigger>\n                  <PromptInputModelSelectValue />\n                </PromptInputModelSelectTrigger>\n                <PromptInputModelSelectContent>\n                  {availableModels.map((model) => (\n                    <PromptInputModelSelectItem key={model} value={model}>\n                      {model}\n                    </PromptInputModelSelectItem>\n                  ))}\n                </PromptInputModelSelectContent>\n              </PromptInputModelSelect>\n            </PromptInputTools>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={onClose}\n                className=\"text-muted-foreground hover:text-foreground\"\n              >\n                Close Chat\n              </Button>\n              <PromptInputSubmit disabled={!text} status={status} />\n            </div>\n          </PromptInputToolbar>\n        </PromptInput>\n      </div>\n    </div>\n  );\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4770, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/ui/switch.tsx"],"sourcesContent":["import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,uBAAS,mNAAgB,CAG7B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC,0KAAqB;QACpB,WAAW,IAAA,kHAAE,EACX,+XACA;QAED,GAAG,KAAK;QACT,KAAK;kBAEL,cAAA,8OAAC,2KAAsB;YACrB,WAAW,IAAA,kHAAE,EACX;;;;;;;;;;;AAKR,OAAO,WAAW,GAAG,0KAAqB,CAAC,WAAW"}},
    {"offset": {"line": 4804, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/components/SelectionModal.tsx"],"sourcesContent":["import {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\n\ninterface SelectionItem {\n  name: string;\n  path: string;\n  thumbnail: string;\n}\n\ninterface SelectionModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  title: string;\n  description: string;\n  items: SelectionItem[];\n  selectedItem: string;\n  onSelectItem: (path: string) => void;\n  descriptionId: string;\n}\n\nexport const SelectionModal = ({\n  open,\n  onOpenChange,\n  title,\n  description,\n  items,\n  selectedItem,\n  onSelectItem,\n  descriptionId,\n}: SelectionModalProps) => {\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent\n        className=\"sm:max-w-[600px]\"\n        aria-describedby={descriptionId}\n      >\n        <DialogHeader>\n          <DialogTitle>{title}</DialogTitle>\n          <DialogDescription id={descriptionId}>\n            {description}\n          </DialogDescription>\n        </DialogHeader>\n        <div className=\"max-h-[60vh] overflow-y-auto\">\n          <div className=\"grid grid-cols-3 gap-4 p-4\">\n            {items.map((item) => (\n              <button\n                key={item.path}\n                onClick={() => onSelectItem(item.path)}\n                className=\"group relative flex flex-col items-center gap-2 transition-transform hover:-translate-y-2\"\n              >\n                <div\n                  className={`w-full aspect-square rounded-2xl overflow-hidden border-2 transition-colors ${\n                    selectedItem === item.path\n                      ? \"border-primary\"\n                      : \"border-transparent group-hover:border-primary/50\"\n                  }`}\n                >\n                  <img\n                    src={item.thumbnail}\n                    alt={item.name}\n                    className=\"w-full h-full object-cover\"\n                  />\n                </div>\n                <span className=\"text-sm font-medium text-center\">\n                  {item.name}\n                </span>\n              </button>\n            ))}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n"],"names":[],"mappings":";;;;;AAAA;;;AAyBO,MAAM,iBAAiB,CAAC,EAC7B,IAAI,EACJ,YAAY,EACZ,KAAK,EACL,WAAW,EACX,KAAK,EACL,YAAY,EACZ,YAAY,EACZ,aAAa,EACO;IACpB,qBACE,8OAAC,qIAAM;QAAC,MAAM;QAAM,cAAc;kBAChC,cAAA,8OAAC,4IAAa;YACZ,WAAU;YACV,oBAAkB;;8BAElB,8OAAC,2IAAY;;sCACX,8OAAC,0IAAW;sCAAE;;;;;;sCACd,8OAAC,gJAAiB;4BAAC,IAAI;sCACpB;;;;;;;;;;;;8BAGL,8OAAC;oBAAI,WAAU;8BACb,cAAA,8OAAC;wBAAI,WAAU;kCACZ,MAAM,GAAG,CAAC,CAAC,qBACV,8OAAC;gCAEC,SAAS,IAAM,aAAa,KAAK,IAAI;gCACrC,WAAU;;kDAEV,8OAAC;wCACC,WAAW,CAAC,4EAA4E,EACtF,iBAAiB,KAAK,IAAI,GACtB,mBACA,oDACJ;kDAEF,cAAA,8OAAC;4CACC,KAAK,KAAK,SAAS;4CACnB,KAAK,KAAK,IAAI;4CACd,WAAU;;;;;;;;;;;kDAGd,8OAAC;wCAAK,WAAU;kDACb,KAAK,IAAI;;;;;;;+BAlBP,KAAK,IAAI;;;;;;;;;;;;;;;;;;;;;;;;;;AA2B9B"}},
    {"offset": {"line": 4907, "column": 0}, "map": {"version":3,"sources":["file:///home/danarit/Projects/private-ai-chat/app/avatar-vrm/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useEffect } from \"react\";\nimport { VRMViewer, VRMViewerRef } from \"@/components/VRMViewer\";\nimport { VRMDatGUIControl } from \"@/components/VRMDatGUIControl\";\nimport { DockMenu } from \"@/components/DockMenu\";\nimport { ChatPrompt } from \"@/components/ChatPrompt\";\n\ninterface PoseData {\n  name?: string;\n  code?: string;\n  vrmVersion?: string;\n  data?: Record<string, unknown>;\n}\nimport { Settings as SettingsIcon, Upload, Menu } from \"lucide-react\";\nimport { predefinedAvatars } from \"@/constants\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuTrigger,\n  DropdownMenuRadioItem,\n} from \"@/components/ui/dropdown-menu\";\nimport { SelectionModal } from \"@/components/SelectionModal\";\nimport { useRouter } from \"next/navigation\";\nimport { useSidebar } from \"@/components/ui/sidebar\";\n\n// API URL for chat backend\nconst CHAT_URL = process.env.NEXT_PUBLIC_CHAT_URL || \"http://localhost:5004\";\n\nexport default function AvatarVRMPage() {\n  const router = useRouter();\n  const [isRecording, setIsRecording] = useState(false);\n  const [audioInputs, setAudioInputs] = useState<MediaDeviceInfo[]>([]);\n  const [selectedInputId, setSelectedInputId] = useState<string>(\"\");\n  const [isVRMLoaded, setIsVRMLoaded] = useState(false);\n  const [loadingProgress, setLoadingProgress] = useState(0);\n  const [isLoading, setIsLoading] = useState(false);\n  const [showSkipButton, setShowSkipButton] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [showAvatarModal, setShowAvatarModal] = useState(false);\n  const [selectedAvatar, setSelectedAvatar] = useState(\n    \"/models/vrm/HatsuneMikuNT.vrm\"\n  );\n  const [hasLoadedInitially, setHasLoadedInitially] = useState(false);\n  const [showChatPrompt, setShowChatPrompt] = useState(false);\n  const [enableSmoothCamera, setEnableSmoothCamera] = useState(true);\n  const [cameraFollowCharacter, setCameraFollowCharacter] = useState(false);\n  const [hideGridAxes, setHideGridAxes] = useState(false);\n  const [viewerMode, setViewerMode] = useState<\"vrm\" | \"gltf\">(\"vrm\");\n  const [animationSpeed, setAnimationSpeed] = useState(0.5);\n\n  // VRM Control states\n  const [expressions, setExpressions] = useState<\n    Array<{ name: string; value: number }>\n  >([]);\n  const [shapeKeys, setShapeKeys] = useState<\n    Array<{ name: string; value: number }>\n  >([]);\n  const [springBones, setSpringBones] = useState<\n    Array<{\n      name: string;\n      settings: {\n        dragForce: number;\n        gravityPower: number;\n        hitRadius: number;\n        stiffness: number;\n        gravityDir: { x: number; y: number; z: number };\n      };\n    }>\n  >([]);\n\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const audioChunksRef = useRef<Blob[]>([]);\n  const audioRef = useRef<HTMLAudioElement | null>(null);\n  const vrmViewerRef = useRef<VRMViewerRef>(null);\n  const blinkIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const analyserRef = useRef<AnalyserNode | null>(null);\n  const isAudioSetupRef = useRef(false);\n  const skipTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const loadCancelledRef = useRef(false);\n  const audioPermissionRequestedRef = useRef(false);\n  const { toggleSidebar } = useSidebar();\n\n  const handleSkipLoading = () => {\n    console.log(\"â­ï¸ User skipped loading\");\n    loadCancelledRef.current = true;\n    setIsLoading(false);\n    setShowSkipButton(false);\n    if (skipTimeoutRef.current) {\n      clearTimeout(skipTimeoutRef.current);\n      skipTimeoutRef.current = null;\n    }\n  };\n\n  // Handle audio playback from chat input\n  const handleChatAudioGenerated = (audioUrl: string) => {\n    console.log(\"ðŸ”Š Playing audio from chat input...\");\n\n    if (audioRef.current) {\n      audioRef.current.src = audioUrl;\n\n      // Setup audio analysis for mouth animation (only once)\n      if (!isAudioSetupRef.current && audioRef.current) {\n        const audioContext = new AudioContext();\n        const audioElement = audioRef.current;\n        const source = audioContext.createMediaElementSource(audioElement);\n        const analyser = audioContext.createAnalyser();\n        analyser.fftSize = 256;\n        source.connect(analyser);\n        analyser.connect(audioContext.destination);\n\n        audioContextRef.current = audioContext;\n        analyserRef.current = analyser;\n        isAudioSetupRef.current = true;\n      }\n\n      // Animate mouth based on TTS audio\n      if (analyserRef.current) {\n        const dataArray = new Uint8Array(analyserRef.current.frequencyBinCount);\n        let isPlaying = true;\n\n        const animateMouth = () => {\n          if (!isPlaying || !analyserRef.current) return;\n\n          analyserRef.current.getByteFrequencyData(dataArray);\n          const sum = dataArray.reduce((a, b) => a + b, 0);\n          const average = sum / dataArray.length;\n          const mouthValue = Math.min(Math.max((average - 5) / 50, 0), 1);\n\n          if (vrmViewerRef.current) {\n            vrmViewerRef.current.setExpression(\"aa\", mouthValue);\n          }\n\n          requestAnimationFrame(animateMouth);\n        };\n\n        // Start animation when audio plays\n        audioRef.current.onplay = () => {\n          isPlaying = true;\n          animateMouth();\n        };\n\n        // Stop animation when audio ends\n        audioRef.current.onended = () => {\n          isPlaying = false;\n          if (vrmViewerRef.current) {\n            vrmViewerRef.current.setExpression(\"aa\", 0);\n          }\n        };\n      }\n\n      audioRef.current.play();\n    }\n  };\n\n  const startRecording = async () => {\n    try {\n      // Request audio permission on first use\n      if (!audioPermissionRequestedRef.current) {\n        console.log(\"ðŸŽ¤ Requesting microphone permission...\");\n        audioPermissionRequestedRef.current = true;\n      }\n\n      const audioConstraints = selectedInputId\n        ? { deviceId: { exact: selectedInputId } }\n        : true;\n\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: audioConstraints,\n      });\n      const mediaRecorder = new MediaRecorder(stream);\n      mediaRecorderRef.current = mediaRecorder;\n      audioChunksRef.current = [];\n\n      mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          audioChunksRef.current.push(event.data);\n        }\n      };\n\n      mediaRecorder.onstop = async () => {\n        const recordedAudioBlob = new Blob(audioChunksRef.current, {\n          type: \"audio/webm\",\n        });\n\n        try {\n          // Step 1: Send audio to Whisper for transcription\n          const formData = new FormData();\n          formData.append(\"audio\", recordedAudioBlob, \"recording.webm\");\n\n          console.log(\"ðŸŽ¤ Sending audio to Whisper for transcription...\");\n          const whisperResponse = await fetch(\n            \"http://localhost:5001/transcribe\",\n            {\n              method: \"POST\",\n              body: formData,\n            }\n          );\n\n          if (!whisperResponse.ok) {\n            throw new Error(\"Whisper transcription failed\");\n          }\n\n          const whisperData = await whisperResponse.json();\n          const transcribedText = whisperData.text;\n          console.log(\"âœ… Transcription:\", transcribedText);\n\n          // Step 2: Query RAG system for relevant context\n          console.log(\"ðŸ” Querying RAG system for context...\");\n          let ragContext = \"\";\n          try {\n            const ragResponse = await fetch(\"http://localhost:5003/query\", {\n              method: \"POST\",\n              headers: {\n                \"Content-Type\": \"application/json\",\n              },\n              body: JSON.stringify({ query: transcribedText }),\n            });\n\n            if (ragResponse.ok) {\n              const ragData = await ragResponse.json();\n              if (ragData.has_context) {\n                ragContext = ragData.context;\n                console.log(\n                  \"âœ… RAG Context retrieved:\",\n                  ragData.contexts.length,\n                  \"chunks\"\n                );\n              } else {\n                console.log(\"â„¹ No relevant context found in documents\");\n              }\n            } else {\n              console.warn(\n                \"âš  RAG server unavailable, continuing without context\"\n              );\n            }\n          } catch (error) {\n            console.warn(\"âš  RAG query failed:\", error);\n            console.log(\"  Continuing without document context...\");\n          }\n\n          // Step 3: Send to backend chat server (same as ChatPage)\n          console.log(\"ðŸ¤– Sending to LLM for processing...\");\n\n          // Build system prompt with context if available\n          let systemPrompt =\n            \"Kamu adalah asisten AI yang membantu. Selalu jawab dalam Bahasa Indonesia yang sopan dan jelas. Berikan jawaban yang SINGKAT dan LANGSUNG KE INTI. Jangan memberikan penjelasan panjang kecuali diminta. Untuk pertanyaan sederhana, jawab dengan 1-2 kalimat saja.\";\n\n          if (ragContext) {\n            systemPrompt += `\\n\\nGunakan informasi berikut sebagai referensi untuk menjawab pertanyaan:\\n\\n${ragContext}\\n\\nJawab berdasarkan informasi di atas jika relevan dengan pertanyaan. Jika informasi tidak cukup atau tidak relevan, jawab berdasarkan pengetahuan umum.`;\n          }\n\n          const chatMessages = [\n            { role: \"system\", content: systemPrompt },\n            { role: \"user\", content: transcribedText },\n          ];\n\n          const response = await fetch(`${CHAT_URL}/chat`, {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n              model: \"mistral:7b\",\n              messages: chatMessages,\n              stream: true,\n            }),\n          });\n\n          if (!response.ok) {\n            throw new Error(\"Chat server error\");\n          }\n\n          const reader = response.body?.getReader();\n          const decoder = new TextDecoder();\n          let fullResponse = \"\";\n\n          while (reader) {\n            const { done, value } = await reader.read();\n            if (done) break;\n\n            const chunk = decoder.decode(value);\n            const lines = chunk.split(\"\\n\").filter((line) => line.trim());\n\n            for (const line of lines) {\n              try {\n                const json = JSON.parse(line);\n                if (json.message?.content) {\n                  fullResponse += json.message.content;\n                }\n              } catch {\n                // Skip invalid JSON\n              }\n            }\n          }\n          console.log(\"âœ… LLM Response:\", fullResponse);\n\n          // Step 4: Send LLM response to TTS server\n          console.log(\"ðŸ”Š Sending to TTS for speech synthesis...\");\n          const ttsResponse = await fetch(\"http://localhost:5002/synthesize\", {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({ text: fullResponse }),\n          });\n\n          if (!ttsResponse.ok) {\n            throw new Error(\"TTS synthesis failed\");\n          }\n\n          const ttsAudioBlob = await ttsResponse.blob();\n          const audioUrl = URL.createObjectURL(ttsAudioBlob);\n          console.log(\"âœ… TTS audio generated\");\n\n          // Step 5: Play TTS audio and animate mouth\n          if (audioRef.current) {\n            audioRef.current.src = audioUrl;\n\n            // Setup audio analysis for mouth animation (only once)\n            if (!isAudioSetupRef.current && audioRef.current) {\n              const audioContext = new AudioContext();\n              const audioElement = audioRef.current;\n              const source =\n                audioContext.createMediaElementSource(audioElement);\n              const analyser = audioContext.createAnalyser();\n              analyser.fftSize = 256;\n              source.connect(analyser);\n              analyser.connect(audioContext.destination);\n\n              audioContextRef.current = audioContext;\n              analyserRef.current = analyser;\n              isAudioSetupRef.current = true;\n            }\n\n            // Animate mouth based on TTS audio\n            if (analyserRef.current) {\n              const dataArray = new Uint8Array(\n                analyserRef.current.frequencyBinCount\n              );\n              let isPlaying = true;\n\n              const animateMouth = () => {\n                if (!isPlaying || !analyserRef.current) return;\n\n                analyserRef.current.getByteFrequencyData(dataArray);\n                const sum = dataArray.reduce((a, b) => a + b, 0);\n                const average = sum / dataArray.length;\n                const mouthValue = Math.min(Math.max((average - 5) / 50, 0), 1);\n\n                if (vrmViewerRef.current) {\n                  vrmViewerRef.current.setExpression(\"aa\", mouthValue);\n                }\n\n                requestAnimationFrame(animateMouth);\n              };\n\n              // Start animation when audio plays\n              audioRef.current.onplay = () => {\n                isPlaying = true;\n                animateMouth();\n              };\n\n              // Stop animation when audio ends\n              audioRef.current.onended = () => {\n                isPlaying = false;\n                if (vrmViewerRef.current) {\n                  vrmViewerRef.current.setExpression(\"aa\", 0);\n                }\n              };\n            }\n\n            audioRef.current.play();\n          }\n        } catch (error) {\n          console.error(\"âŒ Error in voice processing pipeline:\", error);\n          alert(\n            \"Failed to process voice. Please check if all servers are running.\"\n          );\n        }\n\n        // Stop all tracks\n        stream.getTracks().forEach((track) => track.stop());\n      };\n\n      mediaRecorder.start();\n      setIsRecording(true);\n    } catch (error) {\n      console.error(\"Error accessing microphone:\", error);\n      alert(\"Could not access microphone. Please check permissions.\");\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n\n  const handleToggleRecording = () => {\n    if (isRecording) {\n      stopRecording();\n    } else {\n      startRecording();\n    }\n  };\n\n  const handleUploadModel = () => {\n    // Don't clear automatically - user should use \"Clear 3D Model\" first if needed\n    fileInputRef.current?.click();\n  };\n\n  const handleAvatarSelect = async (avatarPath: string) => {\n    try {\n      console.log(\"ðŸ”„ Switching to avatar:\", avatarPath);\n\n      // Special handling for Larasdyah - navigate to GLTF viewer\n      if (avatarPath === \"/models/glb/Larasdyah_Character2.glb\") {\n        console.log(\"ðŸ”„ Navigating to GLTF viewer for Larasdyah model\");\n        router.push(\"/avatar-gltf\");\n        setShowAvatarModal(false);\n        return;\n      }\n\n      setShowAvatarModal(false);\n\n      // Clear existing model first\n      if (vrmViewerRef.current) {\n        vrmViewerRef.current.clearScene();\n        setIsVRMLoaded(false);\n      }\n\n      await new Promise((resolve) => setTimeout(resolve, 150));\n\n      setIsLoading(true);\n      setLoadingProgress(0);\n\n      if (vrmViewerRef.current) {\n        await vrmViewerRef.current.loadVRM(avatarPath, (progress) => {\n          setLoadingProgress(progress);\n        });\n        setIsLoading(false);\n        setIsVRMLoaded(true);\n        setSelectedAvatar(avatarPath);\n        setHasLoadedInitially(true); // Mark as loaded to prevent useEffect from re-running\n\n        // Update VRM data for controls\n        setTimeout(() => updateVRMData(), 100);\n\n        console.log(\"âœ… Avatar switched successfully!\");\n      }\n    } catch (error) {\n      console.error(\"âŒ Failed to switch avatar:\", error);\n      setIsLoading(false);\n      setIsVRMLoaded(false);\n    }\n  };\n\n  const handleViewerModeChange = (mode: string) => {\n    if (mode === \"gltf\") {\n      router.push(\"/avatar-gltf\");\n    } else {\n      setViewerMode(\"vrm\");\n    }\n  };\n\n  // Update VRM data for controls\n  const updateVRMData = () => {\n    if (vrmViewerRef.current) {\n      const newExpressions = vrmViewerRef.current.getExpressions();\n      const newShapeKeys = vrmViewerRef.current.getShapeKeys();\n      const newSpringBones = vrmViewerRef.current.getSpringBones();\n\n      console.log(\"ðŸ“Š Retrieved expressions:\", newExpressions);\n      console.log(\"ðŸ“Š Retrieved shapeKeys:\", newShapeKeys);\n      console.log(\"ðŸ“Š Retrieved springBones:\", newSpringBones);\n\n      setExpressions(newExpressions);\n      setShapeKeys(newShapeKeys);\n      setSpringBones(newSpringBones);\n\n      console.log(\"âœ… State updated\");\n    }\n  };\n\n  // VRM Control Handlers\n  const handlePoseLoad = (poseData: PoseData) => {\n    if (vrmViewerRef.current) {\n      vrmViewerRef.current.loadPose(\n        poseData as {\n          name?: string;\n          code?: string;\n          vrmVersion?: string;\n          data?: Record<string, { rotation: [number, number, number, number] }>;\n        }\n      );\n    }\n  };\n\n  const handleBoneManipulationModeChange = (mode: \"off\" | \"ik\" | \"fk\") => {\n    console.log(\"Bone manipulation mode changed to:\", mode);\n    if (vrmViewerRef.current) {\n      vrmViewerRef.current.setBoneManipulationMode(mode);\n    }\n  };\n\n  const handleExpressionChange = (name: string, value: number) => {\n    if (vrmViewerRef.current) {\n      vrmViewerRef.current.setExpression(name, value);\n      // Update local state\n      setExpressions((prev) =>\n        prev.map((exp) => (exp.name === name ? { ...exp, value } : exp))\n      );\n    }\n  };\n\n  const handleShapeKeyChange = (name: string, value: number) => {\n    if (vrmViewerRef.current) {\n      vrmViewerRef.current.setShapeKey(name, value);\n      // Update local state\n      setShapeKeys((prev) =>\n        prev.map((key) => (key.name === name ? { ...key, value } : key))\n      );\n    }\n  };\n\n  const handleSpringBoneSettingChange = (\n    boneName: string,\n    setting: string,\n    value: number\n  ) => {\n    console.log(`Spring bone ${boneName} ${setting} changed to:`, value);\n    // Spring bone settings would need to be applied via VRM spring bone manager\n    // This is more advanced and may require direct access to the VRM spring bone system\n  };\n\n  const handleSavePose = (poseName: string) => {\n    if (vrmViewerRef.current) {\n      const poseData = vrmViewerRef.current.getCurrentPoseData();\n      if (poseData) {\n        poseData.name = poseName;\n        console.log(\"Saved pose:\", poseData);\n        // You could save this to localStorage or a database\n      }\n    }\n  };\n\n  const handleAnimationPlay = async (animationUrl: string) => {\n    if (vrmViewerRef.current) {\n      try {\n        await vrmViewerRef.current.loadAnimation(animationUrl);\n        console.log(\"âœ… Animation loaded:\", animationUrl);\n      } catch (error) {\n        console.error(\"âŒ Failed to load animation:\", error);\n      }\n    }\n  };\n\n  const handleAnimationSpeedChange = (speed: number) => {\n    setAnimationSpeed(speed);\n    if (vrmViewerRef.current) {\n      vrmViewerRef.current.setAnimationSpeed(speed);\n    }\n  };\n\n  const handleResetCharacter = () => {\n    if (vrmViewerRef.current) {\n      // Reset character position to origin and stop animation\n      vrmViewerRef.current.resetCharacterPosition();\n\n      // Reset camera position\n      vrmViewerRef.current.resetCameraPosition();\n\n      console.log(\"âœ… Character reset to T-pose and origin position\");\n    }\n  };\n\n  const handleFileSelected = async (\n    event: React.ChangeEvent<HTMLInputElement>\n  ) => {\n    const file = event.target.files?.[0];\n    if (file && file.name.endsWith(\".vrm\")) {\n      try {\n        console.log(\n          \"ðŸ“ File selected:\",\n          file.name,\n          `(${(file.size / 1024 / 1024).toFixed(2)} MB)`\n        );\n\n        // Step 1: Clear existing model first\n        console.log(\"ðŸ§¹ Clearing existing model...\");\n        if (vrmViewerRef.current) {\n          vrmViewerRef.current.clearScene();\n          setIsVRMLoaded(false);\n        }\n\n        // Step 2: Small delay to ensure cleanup is complete\n        await new Promise((resolve) => setTimeout(resolve, 150));\n\n        // Step 3: Read file as ArrayBuffer\n        console.log(\"ðŸ“– Reading file...\");\n        setIsLoading(true);\n        setLoadingProgress(0);\n\n        const arrayBuffer = await file.arrayBuffer();\n        console.log(\"âœ… File read complete, loading VRM...\");\n\n        // Step 4: Load the new model\n        if (vrmViewerRef.current) {\n          await vrmViewerRef.current.loadVRM(arrayBuffer, (progress) => {\n            setLoadingProgress(progress);\n          });\n          setIsLoading(false);\n          setIsVRMLoaded(true);\n\n          // Update VRM data for controls\n          setTimeout(() => updateVRMData(), 100);\n\n          console.log(\"âœ… VRM model loaded successfully!\");\n          // Reset file input after successful upload\n          event.target.value = \"\";\n        }\n      } catch (error) {\n        console.error(\"âŒ Failed to load VRM file:\", error);\n        alert(\n          \"Failed to load VRM file. Please make sure it's a valid VRM model.\"\n        );\n        // Reset states on error\n        setIsLoading(false);\n        setIsVRMLoaded(false);\n      }\n    } else {\n      alert(\"Please select a valid VRM file (.vrm extension)\");\n    }\n  };\n\n  // Audio permission will be requested on first record button press\n\n  // Global error handling for debugging mobile issues\n  useEffect(() => {\n    const handleError = (event: ErrorEvent) => {\n      console.error(\"ðŸ”´ Global error:\", event.error);\n      setError(event.message || \"An error occurred\");\n    };\n\n    const handleUnhandledRejection = (event: PromiseRejectionEvent) => {\n      console.error(\"ðŸ”´ Unhandled rejection:\", event.reason);\n      setError(String(event.reason));\n    };\n\n    window.addEventListener(\"error\", handleError);\n    window.addEventListener(\"unhandledrejection\", handleUnhandledRejection);\n\n    return () => {\n      window.removeEventListener(\"error\", handleError);\n      window.removeEventListener(\n        \"unhandledrejection\",\n        handleUnhandledRejection\n      );\n    };\n  }, []);\n\n  // Enumerate audio devices\n  useEffect(() => {\n    // Check if mediaDevices API is available (may not be on some mobile browsers)\n    if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {\n      console.warn(\"âš ï¸ MediaDevices API not available on this device\");\n      return;\n    }\n\n    const enumerateDevices = async () => {\n      try {\n        const devices = await navigator.mediaDevices.enumerateDevices();\n        const inputs = devices.filter((device) => device.kind === \"audioinput\");\n\n        setAudioInputs(inputs);\n\n        if (inputs.length > 0 && !selectedInputId) {\n          setSelectedInputId(inputs[0].deviceId);\n        }\n      } catch (error) {\n        console.error(\"Error enumerating devices:\", error);\n      }\n    };\n\n    enumerateDevices();\n\n    if (navigator.mediaDevices.addEventListener) {\n      navigator.mediaDevices.addEventListener(\"devicechange\", enumerateDevices);\n    }\n\n    return () => {\n      if (navigator.mediaDevices?.removeEventListener) {\n        navigator.mediaDevices.removeEventListener(\n          \"devicechange\",\n          enumerateDevices\n        );\n      }\n    };\n  }, [selectedInputId]);\n\n  // Initial load: show loading overlay and progress for default model\n  useEffect(() => {\n    // Only load on initial mount, not when selectedAvatar changes\n    if (hasLoadedInitially) return;\n\n    let cancelled = false;\n    const loadDefaultModel = async () => {\n      if (vrmViewerRef.current) {\n        setIsLoading(true);\n        setLoadingProgress(0);\n        setShowSkipButton(false);\n        loadCancelledRef.current = false;\n\n        // Start timer to show skip button after 10 seconds\n        skipTimeoutRef.current = setTimeout(() => {\n          if (!cancelled && !loadCancelledRef.current) {\n            setShowSkipButton(true);\n          }\n        }, 10000);\n\n        try {\n          await vrmViewerRef.current.loadVRM(selectedAvatar, (progress) => {\n            if (!cancelled && !loadCancelledRef.current) {\n              setLoadingProgress(progress);\n            }\n          });\n          if (!cancelled && !loadCancelledRef.current) {\n            setIsLoading(false);\n            setIsVRMLoaded(true);\n            setHasLoadedInitially(true);\n            setShowSkipButton(false);\n            if (skipTimeoutRef.current) {\n              clearTimeout(skipTimeoutRef.current);\n            }\n\n            // Update VRM data for controls\n            setTimeout(() => updateVRMData(), 100);\n          }\n        } catch {\n          if (!cancelled && !loadCancelledRef.current) {\n            setIsLoading(false);\n            setIsVRMLoaded(false);\n            setShowSkipButton(false);\n          }\n        }\n      }\n    };\n    loadDefaultModel();\n    return () => {\n      cancelled = true;\n      if (skipTimeoutRef.current) {\n        clearTimeout(skipTimeoutRef.current);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []); // Only run on mount\n\n  // Periodic blink idle animation\n  useEffect(() => {\n    // Don't start blinking until VRM is loaded\n    if (!isVRMLoaded) return;\n\n    const triggerBlink = () => {\n      if (!vrmViewerRef.current) return;\n\n      // Smooth blink animation with transitions\n      const transitionDuration = 100; // 0.1 seconds\n      const steps = 10;\n      const stepDelay = transitionDuration / steps;\n\n      // Close eyes (0 -> 1)\n      let currentStep = 0;\n      const closeInterval = setInterval(() => {\n        currentStep++;\n        const value = currentStep / steps;\n        if (vrmViewerRef.current) {\n          vrmViewerRef.current.setExpression(\"blink\", value);\n        }\n        if (currentStep >= steps) {\n          clearInterval(closeInterval);\n\n          // Keep eyes closed briefly\n          setTimeout(() => {\n            // Open eyes (1 -> 0)\n            let openStep = steps;\n            const openInterval = setInterval(() => {\n              openStep--;\n              const value = openStep / steps;\n              if (vrmViewerRef.current) {\n                vrmViewerRef.current.setExpression(\"blink\", value);\n              }\n              if (openStep <= 0) {\n                clearInterval(openInterval);\n              }\n            }, stepDelay);\n          }, 50);\n        }\n      }, stepDelay);\n    };\n\n    // Random blink interval between 2-4 seconds\n    const scheduleNextBlink = () => {\n      const delay = 2000 + Math.random() * 2000; // 2000-4000ms\n      blinkIntervalRef.current = setTimeout(() => {\n        triggerBlink();\n        scheduleNextBlink();\n      }, delay);\n    };\n\n    scheduleNextBlink();\n\n    return () => {\n      if (blinkIntervalRef.current) {\n        clearTimeout(blinkIntervalRef.current);\n      }\n    };\n  }, [isVRMLoaded]);\n\n  return (\n    <div\n      className=\"flex flex-col w-full fixed inset-0 overflow-hidden lg:pl-64\"\n      style={{ height: \"calc(var(--vh, 1vh) * 100)\" }}\n    >\n      {/* Error Display */}\n      {error && (\n        <div className=\"absolute inset-0 bg-black/80 backdrop-blur-sm z-[60] flex items-center justify-center lg:left-64\">\n          <div className=\"text-center space-y-4 p-8 bg-background/90 rounded-lg max-w-md\">\n            <h2 className=\"text-2xl font-bold text-red-500\">Error</h2>\n            <p className=\"text-sm text-foreground\">{error}</p>\n            <Button onClick={() => setError(null)} variant=\"outline\">\n              Dismiss\n            </Button>\n          </div>\n        </div>\n      )}\n\n      {/* Loading Overlay */}\n      {isLoading && (\n        <div className=\"absolute inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center lg:left-64\">\n          <div className=\"text-center space-y-4\">\n            <div className=\"text-6xl font-bold text-white\">\n              {loadingProgress}%\n            </div>\n            <div className=\"text-xl text-white/80\">Loading 3D Model...</div>\n            <div className=\"w-64 h-2 bg-white/20 rounded-full overflow-hidden\">\n              <div\n                className=\"h-full bg-primary transition-all duration-300\"\n                style={{ width: `${loadingProgress}%` }}\n              />\n            </div>\n            {showSkipButton && (\n              <Button\n                variant=\"outline\"\n                onClick={handleSkipLoading}\n                className=\"mt-4\"\n              >\n                Skip Loading\n              </Button>\n            )}\n          </div>\n        </div>\n      )}\n\n      <header className=\"absolute top-0 left-0 right-0 flex items-center justify-between px-4 h-16 border-b bg-background/80 backdrop-blur-sm z-10 lg:left-64\">\n        <div className=\"flex items-center gap-2 lg:gap-2 w-full lg:w-auto\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={toggleSidebar}\n            className=\"lg:hidden\"\n          >\n            <Menu className=\"h-6 w-6\" />\n          </Button>\n          <h1 className=\"text-xl font-bold absolute left-1/2 -translate-x-1/2 lg:static lg:translate-x-0\">\n            3D Avatar Viewer\n          </h1>\n        </div>\n\n        {/* Desktop Settings Dropdown */}\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"text-base font-semibold max-md:w-10 max-md:h-10 max-md:p-0\"\n            >\n              <span className=\"max-md:hidden\">Settings</span>\n              <SettingsIcon className=\"md:ml-2 h-4 w-4\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\" className=\"w-56\">\n            {/* Smooth Camera Toggle */}\n            <div className=\"flex items-center justify-between px-2 py-3 cursor-pointer hover:bg-accent rounded-sm\">\n              <span className=\"text-sm font-medium\">Smooth Camera</span>\n              <Switch\n                checked={enableSmoothCamera}\n                onCheckedChange={setEnableSmoothCamera}\n              />\n            </div>\n            {/* Camera Follow Character Toggle */}\n            <div className=\"flex items-center justify-between px-2 py-3 cursor-pointer hover:bg-accent rounded-sm\">\n              <span className=\"text-sm font-medium\">\n                Camera Follow Character\n              </span>\n              <Switch\n                checked={cameraFollowCharacter}\n                onCheckedChange={setCameraFollowCharacter}\n              />\n            </div>\n            {/* Hide Grid and Axes Toggle */}\n            <div className=\"flex items-center justify-between px-2 py-3 cursor-pointer hover:bg-accent rounded-sm\">\n              <span className=\"text-sm font-medium\">Hide Grid & Axes</span>\n              <Switch\n                checked={hideGridAxes}\n                onCheckedChange={setHideGridAxes}\n              />\n            </div>\n            {/* Separator */}\n            <Separator className=\"my-1\" />\n            {/* Viewer Mode Tabs */}\n            <div className=\"px-2 py-3\">\n              <p className=\"text-sm font-medium mb-2\">Viewer Mode</p>\n              <Tabs value={viewerMode} onValueChange={handleViewerModeChange}>\n                <TabsList className=\"w-full\">\n                  <TabsTrigger value=\"vrm\" className=\"flex-1\">\n                    VRM\n                  </TabsTrigger>\n                  <TabsTrigger value=\"gltf\" className=\"flex-1\">\n                    GLTF\n                  </TabsTrigger>\n                </TabsList>\n              </Tabs>\n            </div>\n            {/* Separator */}\n            <Separator className=\"my-1\" />\n            {/* Reset Camera Position Button */}\n            <DropdownMenuRadioItem\n              value=\"reset\"\n              onClick={() => {\n                if (vrmViewerRef.current) {\n                  vrmViewerRef.current.resetCameraPosition();\n                }\n              }}\n              className=\"flex items-center justify-center py-3 cursor-pointer hover:bg-accent\"\n            >\n              <span className=\"text-sm font-medium\">Reset Camera Position</span>\n            </DropdownMenuRadioItem>\n            {/* Reset Character Button */}\n            <DropdownMenuRadioItem\n              value=\"reset-character\"\n              onClick={handleResetCharacter}\n              className=\"flex items-center justify-center py-3 cursor-pointer hover:bg-accent\"\n            >\n              <span className=\"text-sm font-medium\">Reset Character</span>\n            </DropdownMenuRadioItem>\n            {/* Upload 3D Model */}\n            <DropdownMenuRadioItem\n              value=\"upload\"\n              onClick={(e) => {\n                e.preventDefault();\n                handleUploadModel();\n              }}\n              className=\"flex flex-col items-center justify-center py-6 cursor-pointer hover:bg-accent\"\n            >\n              <Upload className=\"h-8 w-8 mb-2\" />\n              <span className=\"text-sm font-medium\">Upload 3D Model (VRM)</span>\n            </DropdownMenuRadioItem>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </header>\n\n      <main className=\"flex-1 w-full overflow-hidden relative\">\n        <VRMViewer\n          ref={vrmViewerRef}\n        />\n        {isVRMLoaded && (\n          <VRMDatGUIControl\n            expressions={expressions}\n            shapeKeys={shapeKeys}\n            springBones={springBones}\n            animationSpeed={animationSpeed}\n            onExpressionChange={handleExpressionChange}\n            onShapeKeyChange={handleShapeKeyChange}\n            onSpringBoneSettingChange={handleSpringBoneSettingChange}\n            onPoseLoad={handlePoseLoad}\n            onBoneManipulationModeChange={handleBoneManipulationModeChange}\n            onSavePose={handleSavePose}\n            onAnimationPlay={handleAnimationPlay}\n            onAnimationSpeedChange={handleAnimationSpeedChange}\n          />\n        )}\n      </main>\n\n      <DockMenu\n        isRecording={isRecording}\n        audioInputs={audioInputs}\n        onToggleRecording={handleToggleRecording}\n        onSelectAudioInput={setSelectedInputId}\n        onNavigateHome={() => router.push(\"/\")}\n        onOpenChatPrompt={() => setShowChatPrompt((prev) => !prev)}\n        onOpenAvatarModal={() => setShowAvatarModal(true)}\n      />\n\n      {/* Chat Prompt */}\n      <ChatPrompt\n        open={showChatPrompt}\n        onClose={() => setShowChatPrompt(false)}\n        onAudioGenerated={handleChatAudioGenerated}\n      />\n\n      {/* 3D Avatar Selection Modal */}\n      <SelectionModal\n        open={showAvatarModal}\n        onOpenChange={setShowAvatarModal}\n        title=\"Select 3D Avatar\"\n        description=\"Choose from the available 3D avatars below\"\n        items={predefinedAvatars}\n        selectedItem={selectedAvatar}\n        onSelectItem={handleAvatarSelect}\n        descriptionId=\"avatar-dialog-description\"\n      />\n\n      <audio ref={audioRef} className=\"hidden\" />\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\".vrm\"\n        onChange={handleFileSelected}\n        className=\"hidden\"\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}